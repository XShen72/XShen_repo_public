<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head></head><body>



DSC540_Project_Report_Group05

















    
    
    
    

  <div class="border-box-sizing">
    <div class="container">

<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1>1. Abstract<a rel="noopener" class="anchor-link" href="#1.-Abstract">&#182;</a></h1><ul>
<li>In this project, our main goal is to predict the loan deliquency given the attributes of each loan, and show which attributes contribute most to predict the status of loan. For this purpose, we will use different classification models - logistic regression, decision tree, random forest and xgboost. By comparing metrics including the training and test accuracy, and AUROC score, we select logistic regression / decision tree with 85% accuracy and 63% AUROC score.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1>2. Introduction<a rel="noopener" class="anchor-link" href="#2.-Introduction">&#182;</a></h1><ul>
<li>Credit and loan, they play a significant role in our modern society. They are the fundamental resource to enable us access essential items for our living. for example, buy food using credit card. Meanwhile support pursuing better life, such as loan for a car or mortgage for a house. At the same time, Loan business is absolutely the core unit for all financial institutions. However, there is always a risk that the debt could end-up-with charged off status and the bank may not get planned interest, fees, even lose the principle. In order to avoid this kind of situation, meanwhile not over-react- meaning super cautious, Banks are eager to find out a robust methodology to effectively evaluate necessary profiles from applicants. The ultimate goal of our project is to build a model with several learning algorithms applied. And the model is expected to be the good guideline for financial institutions to evaluate applicants.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1>3. Exploratory Data Analysis<a rel="noopener" class="anchor-link" href="#3.-Exploratory-Data-Analysis">&#182;</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">sklearn</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">sklearn</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">sns</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>

<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.float_format&#39;</span><span class="p">,</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">x</span><span class="p">)</span>     <span class="c1"># avoid exponential</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>0.23.2
0.11.0
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">loan_eda</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;credit_train.csv&#39;</span><span class="p">)</span>

<span class="nb">print</span> <span class="p">(</span><span class="n">loan_eda</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">loan_eda</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">loan_eda</span><span class="o">.</span><span class="n">dtypes</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>                                Loan ID                           Customer ID  \
0  14dd8831-6af5-400b-83ec-68e61888a048  981165ec-3274-42f5-a3b4-d104041a9ca9   
1  4771cc26-131a-45db-b5aa-537ea4ba5342  2de017a3-2e01-49cb-a581-08169e83be29   
2  4eed4e6a-aa2f-4c91-8651-ce984ee8fb26  5efb2b2b-bf11-4dfd-a572-3761a2694725   
3  77598f7b-32e7-4e3b-a6e5-06ba0d98fe8a  e777faab-98ae-45af-9a86-7ce5b33b1011   
4  d4062e70-befa-4995-8643-a0de73938182  81536ad9-5ccf-4eb8-befb-47a4d608658e   

  Loan Status  Current Loan Amount        Term  Credit Score  Annual Income  \
0  Fully Paid            445412.00  Short Term        709.00     1167493.00   
1  Fully Paid            262328.00  Short Term           nan            nan   
2  Fully Paid          99999999.00  Short Term        741.00     2231892.00   
3  Fully Paid            347666.00   Long Term        721.00      806949.00   
4  Fully Paid            176220.00  Short Term           nan            nan   

  Years in current job Home Ownership             Purpose  Monthly Debt  \
0              8 years  Home Mortgage   Home Improvements       5214.74   
1            10+ years  Home Mortgage  Debt Consolidation      33295.98   
2              8 years       Own Home  Debt Consolidation      29200.53   
3              3 years       Own Home  Debt Consolidation       8741.90   
4              5 years           Rent  Debt Consolidation      20639.70   

   Years of Credit History  Months since last delinquent  \
0                    17.20                           nan   
1                    21.10                          8.00   
2                    14.90                         29.00   
3                    12.00                           nan   
4                     6.10                           nan   

   Number of Open Accounts  Number of Credit Problems  Current Credit Balance  \
0                     6.00                       1.00               228190.00   
1                    35.00                       0.00               229976.00   
2                    18.00                       1.00               297996.00   
3                     9.00                       0.00               256329.00   
4                    15.00                       0.00               253460.00   

   Maximum Open Credit  Bankruptcies  Tax Liens  
0            416746.00          1.00       0.00  
1            850784.00          0.00       0.00  
2            750090.00          0.00       0.00  
3            386958.00          0.00       0.00  
4            427174.00          0.00       0.00  
------------------------------------------------------------
(100514, 19)
------------------------------------------------------------
Loan ID                          object
Customer ID                      object
Loan Status                      object
Current Loan Amount             float64
Term                             object
Credit Score                    float64
Annual Income                   float64
Years in current job             object
Home Ownership                   object
Purpose                          object
Monthly Debt                    float64
Years of Credit History         float64
Months since last delinquent    float64
Number of Open Accounts         float64
Number of Credit Problems       float64
Current Credit Balance          float64
Maximum Open Credit             float64
Bankruptcies                    float64
Tax Liens                       float64
dtype: object
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>The Dataset is collected from Kaggle.</li>
<li>There are in total 100,514 records and 19 columns. It contains 7 categorical variables and 12 numerical variables.</li>
<li>This is the statistical summary of the data.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">loan_eda</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[3]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Current Loan Amount</th>
      <th>Credit Score</th>
      <th>Annual Income</th>
      <th>Monthly Debt</th>
      <th>Years of Credit History</th>
      <th>Months since last delinquent</th>
      <th>Number of Open Accounts</th>
      <th>Number of Credit Problems</th>
      <th>Current Credit Balance</th>
      <th>Maximum Open Credit</th>
      <th>Bankruptcies</th>
      <th>Tax Liens</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>100000.00</td>
      <td>80846.00</td>
      <td>80846.00</td>
      <td>100000.00</td>
      <td>100000.00</td>
      <td>46859.00</td>
      <td>100000.00</td>
      <td>100000.00</td>
      <td>100000.00</td>
      <td>99998.00</td>
      <td>99796.00</td>
      <td>99990.00</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>11760447.39</td>
      <td>1076.46</td>
      <td>1378276.56</td>
      <td>18472.41</td>
      <td>18.20</td>
      <td>34.90</td>
      <td>11.13</td>
      <td>0.17</td>
      <td>294637.38</td>
      <td>760798.38</td>
      <td>0.12</td>
      <td>0.03</td>
    </tr>
    <tr>
      <th>std</th>
      <td>31783942.55</td>
      <td>1475.40</td>
      <td>1081360.20</td>
      <td>12174.99</td>
      <td>7.02</td>
      <td>22.00</td>
      <td>5.01</td>
      <td>0.48</td>
      <td>376170.93</td>
      <td>8384503.47</td>
      <td>0.35</td>
      <td>0.26</td>
    </tr>
    <tr>
      <th>min</th>
      <td>10802.00</td>
      <td>585.00</td>
      <td>76627.00</td>
      <td>0.00</td>
      <td>3.60</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>179652.00</td>
      <td>705.00</td>
      <td>848844.00</td>
      <td>10214.16</td>
      <td>13.50</td>
      <td>16.00</td>
      <td>8.00</td>
      <td>0.00</td>
      <td>112670.00</td>
      <td>273438.00</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>312246.00</td>
      <td>724.00</td>
      <td>1174162.00</td>
      <td>16220.30</td>
      <td>16.90</td>
      <td>32.00</td>
      <td>10.00</td>
      <td>0.00</td>
      <td>209817.00</td>
      <td>467874.00</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>524942.00</td>
      <td>741.00</td>
      <td>1650663.00</td>
      <td>24012.06</td>
      <td>21.70</td>
      <td>51.00</td>
      <td>14.00</td>
      <td>0.00</td>
      <td>367958.75</td>
      <td>782958.00</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>max</th>
      <td>99999999.00</td>
      <td>7510.00</td>
      <td>165557393.00</td>
      <td>435843.28</td>
      <td>70.50</td>
      <td>176.00</td>
      <td>76.00</td>
      <td>15.00</td>
      <td>32878968.00</td>
      <td>1539737892.00</td>
      <td>7.00</td>
      <td>15.00</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">loan_eda</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[4]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Loan ID</th>
      <th>Customer ID</th>
      <th>Loan Status</th>
      <th>Current Loan Amount</th>
      <th>Term</th>
      <th>Credit Score</th>
      <th>Annual Income</th>
      <th>Years in current job</th>
      <th>Home Ownership</th>
      <th>Purpose</th>
      <th>Monthly Debt</th>
      <th>Years of Credit History</th>
      <th>Months since last delinquent</th>
      <th>Number of Open Accounts</th>
      <th>Number of Credit Problems</th>
      <th>Current Credit Balance</th>
      <th>Maximum Open Credit</th>
      <th>Bankruptcies</th>
      <th>Tax Liens</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>14dd8831-6af5-400b-83ec-68e61888a048</td>
      <td>981165ec-3274-42f5-a3b4-d104041a9ca9</td>
      <td>Fully Paid</td>
      <td>445412.00</td>
      <td>Short Term</td>
      <td>709.00</td>
      <td>1167493.00</td>
      <td>8 years</td>
      <td>Home Mortgage</td>
      <td>Home Improvements</td>
      <td>5214.74</td>
      <td>17.20</td>
      <td>nan</td>
      <td>6.00</td>
      <td>1.00</td>
      <td>228190.00</td>
      <td>416746.00</td>
      <td>1.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4771cc26-131a-45db-b5aa-537ea4ba5342</td>
      <td>2de017a3-2e01-49cb-a581-08169e83be29</td>
      <td>Fully Paid</td>
      <td>262328.00</td>
      <td>Short Term</td>
      <td>nan</td>
      <td>nan</td>
      <td>10+ years</td>
      <td>Home Mortgage</td>
      <td>Debt Consolidation</td>
      <td>33295.98</td>
      <td>21.10</td>
      <td>8.00</td>
      <td>35.00</td>
      <td>0.00</td>
      <td>229976.00</td>
      <td>850784.00</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4eed4e6a-aa2f-4c91-8651-ce984ee8fb26</td>
      <td>5efb2b2b-bf11-4dfd-a572-3761a2694725</td>
      <td>Fully Paid</td>
      <td>99999999.00</td>
      <td>Short Term</td>
      <td>741.00</td>
      <td>2231892.00</td>
      <td>8 years</td>
      <td>Own Home</td>
      <td>Debt Consolidation</td>
      <td>29200.53</td>
      <td>14.90</td>
      <td>29.00</td>
      <td>18.00</td>
      <td>1.00</td>
      <td>297996.00</td>
      <td>750090.00</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>3</th>
      <td>77598f7b-32e7-4e3b-a6e5-06ba0d98fe8a</td>
      <td>e777faab-98ae-45af-9a86-7ce5b33b1011</td>
      <td>Fully Paid</td>
      <td>347666.00</td>
      <td>Long Term</td>
      <td>721.00</td>
      <td>806949.00</td>
      <td>3 years</td>
      <td>Own Home</td>
      <td>Debt Consolidation</td>
      <td>8741.90</td>
      <td>12.00</td>
      <td>nan</td>
      <td>9.00</td>
      <td>0.00</td>
      <td>256329.00</td>
      <td>386958.00</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>4</th>
      <td>d4062e70-befa-4995-8643-a0de73938182</td>
      <td>81536ad9-5ccf-4eb8-befb-47a4d608658e</td>
      <td>Fully Paid</td>
      <td>176220.00</td>
      <td>Short Term</td>
      <td>nan</td>
      <td>nan</td>
      <td>5 years</td>
      <td>Rent</td>
      <td>Debt Consolidation</td>
      <td>20639.70</td>
      <td>6.10</td>
      <td>nan</td>
      <td>15.00</td>
      <td>0.00</td>
      <td>253460.00</td>
      <td>427174.00</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">target</span> <span class="o">=</span> <span class="s1">&#39;Loan Status&#39;</span>
<span class="nb">print</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Target variable is </span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>


<span class="n">categorical_attributes</span> <span class="o">=</span> <span class="n">loan_eda</span><span class="o">.</span><span class="n">dtypes</span><span class="p">[</span><span class="n">loan_eda</span><span class="o">.</span><span class="n">dtypes</span> <span class="o">==</span> <span class="nb">object</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">categorical_attributes</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Categorical Attributes: &#39;</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="o">*</span><span class="n">categorical_attributes</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;||&#39;</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Number of Categorical Attributes:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">categorical_attributes</span><span class="p">))</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>

<span class="n">numeric_attributes</span> <span class="o">=</span> <span class="n">loan_eda</span><span class="o">.</span><span class="n">dtypes</span><span class="p">[</span><span class="n">loan_eda</span><span class="o">.</span><span class="n">dtypes</span> <span class="o">!=</span> <span class="nb">object</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Numeric Attributes: &#39;</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="o">*</span><span class="n">numeric_attributes</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;||&#39;</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Number of Numeric Attributes:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">numeric_attributes</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Target variable is Loan Status.
------------------------------------------------------------
Categorical Attributes: 
Loan ID||Customer ID||Term||Years in current job||Home Ownership||Purpose
Number of Categorical Attributes: 6
------------------------------------------------------------
Numeric Attributes: 
Current Loan Amount||Credit Score||Annual Income||Monthly Debt||Years of Credit History||Months since last delinquent||Number of Open Accounts||Number of Credit Problems||Current Credit Balance||Maximum Open Credit||Bankruptcies||Tax Liens
------------------------------------------------------------
Number of Numeric Attributes: 12
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Loan Status is the outcome variable. Both categorical attributes and numeric attributes are explanatory variables.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">drop_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Loan ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Customer ID&#39;</span><span class="p">]</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Shape before dropping:&#39;</span><span class="p">,</span> <span class="n">loan_eda</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="n">loan_eda</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">drop_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Shape after dropping:&#39;</span><span class="p">,</span> <span class="n">loan_eda</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Shape before dropping: (100514, 19)
Shape after dropping: (100514, 17)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Loan ID and Customer ID are coming first. Since they are not part of our interest, we just drop these two columns. So, 17 columns remained.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Variables&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Loan Status&#39;</span><span class="p">,</span> <span class="s1">&#39;Current Loan Amount&#39;</span><span class="p">,</span> <span class="s1">&#39;Term&#39;</span><span class="p">,</span> <span class="s1">&#39;Credit Score&#39;</span><span class="p">,</span> <span class="s1">&#39;Annual Income&#39;</span><span class="p">,</span> <span class="s1">&#39;Years in current job&#39;</span><span class="p">,</span><span class="s1">&#39;Home ownership&#39;</span><span class="p">,</span> 
                  <span class="s1">&#39;Purpose&#39;</span><span class="p">,</span> <span class="s1">&#39;Monthly debt&#39;</span><span class="p">,</span> <span class="s1">&#39;Years in credit history&#39;</span><span class="p">,</span> <span class="s1">&#39;Months since last delinquent&#39;</span><span class="p">,</span> <span class="s1">&#39;Number of Open Accounts&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;Number of Credit Problems&#39;</span><span class="p">,</span> <span class="s1">&#39;Current Credit Balance&#39;</span><span class="p">,</span> <span class="s1">&#39;Maximum Open Credit&#39;</span><span class="p">,</span> <span class="s1">&#39;Bankruptcies&#39;</span><span class="p">,</span> <span class="s1">&#39;Tax Liens&#39;</span> <span class="p">],</span> 
     <span class="s1">&#39;Types&#39;</span><span class="p">:[</span><span class="s1">&#39;Categorical&#39;</span><span class="p">,</span> <span class="s1">&#39;Numeric&#39;</span><span class="p">,</span> <span class="s1">&#39;Categorical&#39;</span><span class="p">,</span> <span class="s1">&#39;Numeric&#39;</span><span class="p">,</span> <span class="s1">&#39;Numeric&#39;</span><span class="p">,</span> <span class="s1">&#39;Numeric&#39;</span><span class="p">,</span> <span class="s1">&#39;Categorical&#39;</span><span class="p">,</span> <span class="s1">&#39;Categorical&#39;</span><span class="p">,</span> <span class="s1">&#39;Numeric&#39;</span><span class="p">,</span> <span class="s1">&#39;Numeric&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Numeric&#39;</span><span class="p">,</span> <span class="s1">&#39;Numeric&#39;</span><span class="p">,</span> <span class="s1">&#39;Numeric&#39;</span><span class="p">,</span> <span class="s1">&#39;Numeric&#39;</span><span class="p">,</span> <span class="s1">&#39;Numeric&#39;</span><span class="p">,</span> <span class="s1">&#39;Categorical&#39;</span><span class="p">,</span> <span class="s1">&#39;Categorical&#39;</span><span class="p">],</span> 
     <span class="s1">&#39;Descriptions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Current status of the loan&#39;</span><span class="p">,</span> <span class="s1">&#39;The current listed amount of the loan applied for by the borrower&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;The number of payments on the loan. Values are in months and can be either short term or long term.&#39;</span><span class="p">,</span> 
                     <span class="s1">&#39;The credit score of the customer when applying for the loan.&#39;</span><span class="p">,</span> <span class="s1">&#39;The self-reported annual income provided by the borrower during registration.&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Employment length in years. Possible values are between 0 and 10 where 0 means less than one year and 10 means ten or more years.&#39;</span> <span class="p">,</span>
                     <span class="s1">&#39;The home ownership status provided by the borrower during registration or obtained from the credit report.&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;A category provided by the borrower for the loan request.&#39;</span> <span class="p">,</span>
                     <span class="s1">&#39;The monthly debt paid by the customer.&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;How many years the customer in the bank’s credit history.&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;The number of months since the borrowers last delinquency.&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Number of accounts opened in total.&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Number of credit problems in the bank’s history record.&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;The current credit balance of the customer.&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;The maximum of the credit of the customer.&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Whether the customer having bankruptcies&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Whether the customer having tax license&#39;</span><span class="p">]}</span>
<span class="n">df_dict</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">d</span><span class="p">)</span>
<span class="n">df_dict</span>
<span class="n">df_dict</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">set_properties</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s1">&#39;text-align&#39;</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">})</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[7]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<table><thead>    <tr>        <th class="blank level0"></th>        <th class="col_heading level0 col0">Variables</th>        <th class="col_heading level0 col1">Types</th>        <th class="col_heading level0 col2">Descriptions</th>    </tr></thead><tbody>
                <tr>
                        <th class="row_heading level0 row0">0</th>
                        <td class="data row0 col0">Loan Status</td>
                        <td class="data row0 col1">Categorical</td>
                        <td class="data row0 col2">Current status of the loan</td>
            </tr>
            <tr>
                        <th class="row_heading level0 row1">1</th>
                        <td class="data row1 col0">Current Loan Amount</td>
                        <td class="data row1 col1">Numeric</td>
                        <td class="data row1 col2">The current listed amount of the loan applied for by the borrower</td>
            </tr>
            <tr>
                        <th class="row_heading level0 row2">2</th>
                        <td class="data row2 col0">Term</td>
                        <td class="data row2 col1">Categorical</td>
                        <td class="data row2 col2">The number of payments on the loan. Values are in months and can be either short term or long term.</td>
            </tr>
            <tr>
                        <th class="row_heading level0 row3">3</th>
                        <td class="data row3 col0">Credit Score</td>
                        <td class="data row3 col1">Numeric</td>
                        <td class="data row3 col2">The credit score of the customer when applying for the loan.</td>
            </tr>
            <tr>
                        <th class="row_heading level0 row4">4</th>
                        <td class="data row4 col0">Annual Income</td>
                        <td class="data row4 col1">Numeric</td>
                        <td class="data row4 col2">The self-reported annual income provided by the borrower during registration.</td>
            </tr>
            <tr>
                        <th class="row_heading level0 row5">5</th>
                        <td class="data row5 col0">Years in current job</td>
                        <td class="data row5 col1">Numeric</td>
                        <td class="data row5 col2">Employment length in years. Possible values are between 0 and 10 where 0 means less than one year and 10 means ten or more years.</td>
            </tr>
            <tr>
                        <th class="row_heading level0 row6">6</th>
                        <td class="data row6 col0">Home ownership</td>
                        <td class="data row6 col1">Categorical</td>
                        <td class="data row6 col2">The home ownership status provided by the borrower during registration or obtained from the credit report.</td>
            </tr>
            <tr>
                        <th class="row_heading level0 row7">7</th>
                        <td class="data row7 col0">Purpose</td>
                        <td class="data row7 col1">Categorical</td>
                        <td class="data row7 col2">A category provided by the borrower for the loan request.</td>
            </tr>
            <tr>
                        <th class="row_heading level0 row8">8</th>
                        <td class="data row8 col0">Monthly debt</td>
                        <td class="data row8 col1">Numeric</td>
                        <td class="data row8 col2">The monthly debt paid by the customer.</td>
            </tr>
            <tr>
                        <th class="row_heading level0 row9">9</th>
                        <td class="data row9 col0">Years in credit history</td>
                        <td class="data row9 col1">Numeric</td>
                        <td class="data row9 col2">How many years the customer in the bank’s credit history.</td>
            </tr>
            <tr>
                        <th class="row_heading level0 row10">10</th>
                        <td class="data row10 col0">Months since last delinquent</td>
                        <td class="data row10 col1">Numeric</td>
                        <td class="data row10 col2">The number of months since the borrowers last delinquency.</td>
            </tr>
            <tr>
                        <th class="row_heading level0 row11">11</th>
                        <td class="data row11 col0">Number of Open Accounts</td>
                        <td class="data row11 col1">Numeric</td>
                        <td class="data row11 col2">Number of accounts opened in total.</td>
            </tr>
            <tr>
                        <th class="row_heading level0 row12">12</th>
                        <td class="data row12 col0">Number of Credit Problems</td>
                        <td class="data row12 col1">Numeric</td>
                        <td class="data row12 col2">Number of credit problems in the bank’s history record.</td>
            </tr>
            <tr>
                        <th class="row_heading level0 row13">13</th>
                        <td class="data row13 col0">Current Credit Balance</td>
                        <td class="data row13 col1">Numeric</td>
                        <td class="data row13 col2">The current credit balance of the customer.</td>
            </tr>
            <tr>
                        <th class="row_heading level0 row14">14</th>
                        <td class="data row14 col0">Maximum Open Credit</td>
                        <td class="data row14 col1">Numeric</td>
                        <td class="data row14 col2">The maximum of the credit of the customer.</td>
            </tr>
            <tr>
                        <th class="row_heading level0 row15">15</th>
                        <td class="data row15 col0">Bankruptcies</td>
                        <td class="data row15 col1">Categorical</td>
                        <td class="data row15 col2">Whether the customer having bankruptcies</td>
            </tr>
            <tr>
                        <th class="row_heading level0 row16">16</th>
                        <td class="data row16 col0">Tax Liens</td>
                        <td class="data row16 col1">Categorical</td>
                        <td class="data row16 col2">Whether the customer having tax license</td>
            </tr>
    </tbody></table>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">numeric_attributes</span><span class="p">:</span>
    <span class="n">loan_eda</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The box plot of&#39;</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>The box plot of Current Loan Amount
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>The box plot of Credit Score
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>The box plot of Annual Income
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>The box plot of Monthly Debt
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>The box plot of Years of Credit History
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>The box plot of Months since last delinquent
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>The box plot of Number of Open Accounts
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>The box plot of Number of Credit Problems
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>The box plot of Current Credit Balance
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>The box plot of Maximum Open Credit
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>The box plot of Bankruptcies
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>The box plot of Tax Liens
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">loan_eda</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
              <span class="n">xlabelsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ylabelsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>    
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">rect</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">))</span>   
<span class="n">rt</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Loan Univariate Plots&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.65</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.25</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>  
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Here are exploratory graphs of numerical variables. The first one is Loan univariate plots, which can be used to check the distribution of each variable. As we can see, many of them are in positive skew distribution. After referring the table of statistical summary, we noticed that current Loan Amount in some records is 99,999,999 which seem to be an invalid data. And as we all know, in the US, the credit score generally comes between 300 to 850. But some of credit score from this dataset is even larger than 6000.</li>
<li>The Kernel density estimations demonstrate that two loan status have the similar distribution pattern.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">numeric_attributes</span><span class="p">:</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">displot</span><span class="p">(</span><span class="n">loan_eda</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;Loan Status&quot;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;kde&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">heatmap</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">loan_eda</span><span class="p">[</span><span class="n">numeric_attributes</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(),</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">heatmap</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Correlation Heatmap&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">},</span> <span class="n">pad</span><span class="o">=</span><span class="mi">12</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>The correlation heatmap of all numerical variables. We can easily identify that only number of credit problems and bankruptcies have strong positive correlation</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">Loan_Status</span> <span class="o">=</span> <span class="n">loan_eda</span><span class="p">[</span><span class="s1">&#39;Loan Status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="n">Loan_Status</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">Loan_Status</span><span class="o">.</span><span class="n">index</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="n">Loan_Status</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">title</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Loan Status&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Loan Status&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">)</span> 
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mf">8.5</span><span class="p">)</span>

<span class="n">bar</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">Loan_Status</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>  
             <span class="n">Loan_Status</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
             <span class="n">width</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span>
             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">,</span> 
             <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>It is the bar chart of loan status. In this dataset, the charged off is nearly one third of fully paid.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">loan_eda</span><span class="p">[</span><span class="s1">&#39;Term&#39;</span><span class="p">],</span> <span class="n">loan_eda</span><span class="p">[</span><span class="s1">&#39;Loan Status&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> 
                                                            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Purpose of Loan Vs Loan Payment Status&quot;</span><span class="p">,</span> <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[13]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.axes._subplots.AxesSubplot at 0x2393a208d48&gt;</pre>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>This plot shows loan term versus loan status. We found out that short term is doing better- with less charged off percentage. But still nearly one fourth of short term loan end-up-with unfinished. And there’s also an interesting observation that almost a half of customers who have long-term debt couldn’t pay it in this dataset, which is not good for bank operation in long term.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">loan_eda</span><span class="p">[</span><span class="s1">&#39;Purpose&#39;</span><span class="p">],</span> <span class="n">loan_eda</span><span class="p">[</span><span class="s1">&#39;Loan Status&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> 
                                                               <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Purpose of Loan Vs Loan Payment Status&quot;</span><span class="p">,</span> <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[14]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.axes._subplots.AxesSubplot at 0x2393d3cd2c8&gt;</pre>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>The next graph shows numbers of debt by purpose, debt consolidation stand-up, takes big part. Debt consolidation means combining more than one debt obligation into a new loan, it can lower your monthly payments, but can also hurt your credit score. As we can see, debt consolidation is a way to help the bank get some money back and reduce bank’s bad debt.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Missing count: </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">loan_eda</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Missing rate: </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">loan_eda</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Missing count: 
 Loan Status                       514
Current Loan Amount               514
Term                              514
Credit Score                    19668
Annual Income                   19668
Years in current job             4736
Home Ownership                    514
Purpose                           514
Monthly Debt                      514
Years of Credit History           514
Months since last delinquent    53655
Number of Open Accounts           514
Number of Credit Problems         514
Current Credit Balance            514
Maximum Open Credit               516
Bankruptcies                      718
Tax Liens                         524
dtype: int64
------------------------------------------------------------
Missing rate: 
 Loan Status                    0.01
Current Loan Amount            0.01
Term                           0.01
Credit Score                   0.20
Annual Income                  0.20
Years in current job           0.05
Home Ownership                 0.01
Purpose                        0.01
Monthly Debt                   0.01
Years of Credit History        0.01
Months since last delinquent   0.53
Number of Open Accounts        0.01
Number of Credit Problems      0.01
Current Credit Balance         0.01
Maximum Open Credit            0.01
Bankruptcies                   0.01
Tax Liens                      0.01
dtype: float64
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[16]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">missingno</span> <span class="k">as</span> <span class="nn">msno</span>
<span class="n">msno</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">loan_eda</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>The missing rate of some columns are same, we considered that all values in some rows are missing. And the missing rate of variable Months since last delinquent is larger than 0.5.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1>4. Research Question<a rel="noopener" class="anchor-link" href="#4.-Research-Question">&#182;</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3>4.1. IS THERE ANY INFORMATION LEAKAGE WITHIN THE SELECTED VARIABLES?<a rel="noopener" class="anchor-link" href="#4.1.-IS-THERE-ANY-INFORMATION-LEAKAGE-WITHIN-THE-SELECTED-VARIABLES?">&#182;</a></h3><p>By running the bivariate analysis between each variable and target variable, we find there is no extreme imbalanced distribution, which means charged-off cases are only in one sub-category of specific variable.</p>
<p>But we do find for numeric variable &lt; Credit Score &gt;, when the value of Credit Score is higher than 1000, all cases are charged-off. We think it might the error made during database integration or other types of situation that exaggerate the value. Therefore, what we want to do is to consider those values as missing and impute with KNN.</p>
<p>In general, credict score larger than 850 considered as good credict score, but the histogram below, &quot;Loan Status v.s Fully Paid&quot; shows that there&#39;s credit score higher than 5500. In this thinking, this high credit scores should be missing values. And the most importantly, there&#39;s a large gap between 1000 to 5500.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[17]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">catplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s2">&quot;Credit Score&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;Loan Status&quot;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Charged Off&quot;</span><span class="p">,</span> <span class="s2">&quot;Fully Paid&quot;</span><span class="p">],</span> 
            <span class="n">data</span><span class="o">=</span><span class="n">loan_eda</span><span class="p">)</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Loan Status v.s Fully Paid&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[17]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>&lt;seaborn.axisgrid.FacetGrid at 0x239488ae3c8&gt;</pre>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3>4.2. FINDING POTENTIAL CUSTOMERS WHO HAVE CAPABILITY FOR ADDITIONAL LOAN PRODUCTS?<a rel="noopener" class="anchor-link" href="#4.2.-FINDING-POTENTIAL-CUSTOMERS-WHO-HAVE-CAPABILITY-FOR-ADDITIONAL-LOAN-PRODUCTS?">&#182;</a></h3><p>As a banker, or loan analyst, they must be curious which group of people are the best potential customers and have ability to pay their debt and not become a bad loan.</p>
<p>Thus, by doing some exploratory analysis, good customers who want to borrow money and may fully pay their debt normally have these features.</p>
<ul>
<li><ol>
<li>People who have long work experiences.</li>
</ol>
</li>
<li><ol>
<li>People who have stable life style.</li>
</ol>
</li>
<li><ol>
<li>People who have higher credit score.</li>
</ol>
</li>
</ul>
<p>The resones are as follows:
As the plots shown below, people who work longer than 10 years are the most amount that borrow the money, and as usual thinking, people who work more than 10 years are the group of people have relatively high salaries, thus, they have the most capable to pay their debt in the future.
What&#39;s more, since &lt; Home Mortgage &gt; is the most part of loan purpose, only people who have stable life have necessary to get loan.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[18]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">rcParams</span>

<span class="n">categorical_features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Loan Status&#39;</span><span class="p">,</span> <span class="s1">&#39;Term&#39;</span><span class="p">,</span> <span class="s1">&#39;Years in current job&#39;</span><span class="p">,</span> <span class="s1">&#39;Home Ownership&#39;</span><span class="p">,</span> <span class="s1">&#39;Purpose&#39;</span><span class="p">,</span> <span class="s1">&#39;Bankruptcies&#39;</span><span class="p">]</span>
<span class="n">df_categ</span> <span class="o">=</span> <span class="n">loan_eda</span><span class="p">[</span><span class="n">categorical_features</span><span class="p">]</span>

<span class="n">df_not_num</span> <span class="o">=</span> <span class="n">df_categ</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;There is </span><span class="si">{}</span><span class="s1"> non numerical features including:</span><span class="se">\n</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_not_num</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="n">df_not_num</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>

<span class="c1"># figure size in inches</span>
<span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span><span class="mi">13</span>
<span class="n">sns</span><span class="o">.</span><span class="n">catplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Years in current job&quot;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;Loan Status&quot;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;ch:.25&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_not_num</span><span class="p">,</span>
           <span class="n">height</span><span class="o">=</span><span class="mf">8.27</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mf">11.7</span><span class="o">/</span><span class="mf">8.27</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>There is 5 non numerical features including:
[&#39;Loan Status&#39;, &#39;Term&#39;, &#39;Years in current job&#39;, &#39;Home Ownership&#39;, &#39;Purpose&#39;]
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt output_prompt">Out[18]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>&lt;seaborn.axisgrid.FacetGrid at 0x23948880588&gt;</pre>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[19]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">catplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Home Ownership&quot;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;Loan Status&quot;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;ch:.25&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_not_num</span><span class="p">,</span>
           <span class="n">height</span><span class="o">=</span><span class="mf">8.27</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mf">11.7</span><span class="o">/</span><span class="mf">8.27</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[19]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>&lt;seaborn.axisgrid.FacetGrid at 0x2393dc5dd48&gt;</pre>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3>4.3. WHEN WE RAN SOME BASIC EXPLORATORY ANALYSIS, WE FOUND ALL ATTRIBUTES HAVING MISSING VALUES, SO HOW TO IMPUTE THE MISSING VALUE?<a rel="noopener" class="anchor-link" href="#4.3.-WHEN-WE-RAN-SOME-BASIC-EXPLORATORY-ANALYSIS,-WE-FOUND-ALL-ATTRIBUTES-HAVING-MISSING-VALUES,-SO-HOW-TO-IMPUTE-THE-MISSING-VALUE?">&#182;</a></h3><p>As the missing rate shown below, the missing of <strong><em>&lt; Months since last delinquent &gt;</em></strong> takes upto 53.38%, more than a half of data are missing, and next are <strong><em>&lt; Credit Score &gt;</em></strong>, and <strong><em>&lt; Annual Income &gt;</em></strong>, but their missing just takes less than 20%. Besides, 514 is a constant missing number for all variables.</p>
<p>Consider that the missing of &lt; Months since last delinquent &gt; is more than 50%, and it didn&#39;t contribute too much for our model evaluation in the future, so we decided to drop &lt; Months since last delinquent &gt;.</p>
<p>As for other varibales, we are going to impute the missing values by using K Nearest Neighbors (KNN) and Multivariate Imputation by Chained Equations (MICE) methods.</p>
<p>And for more accurate and make a better model, we have used different k numbers, such as k=1,3,5,7 to build the imputation mehtods separately.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[20]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">Nulldf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Count&#39;</span><span class="p">:</span> <span class="n">loan_eda</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="s1">&#39;Percent&#39;</span><span class="p">:</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">loan_eda</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">loan_eda</span><span class="p">)})</span>
<span class="n">Nulldf</span><span class="p">[</span><span class="n">Nulldf</span><span class="p">[</span><span class="s1">&#39;Count&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[20]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Count</th>
      <th>Percent</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Loan Status</th>
      <td>514</td>
      <td>0.51</td>
    </tr>
    <tr>
      <th>Current Loan Amount</th>
      <td>514</td>
      <td>0.51</td>
    </tr>
    <tr>
      <th>Term</th>
      <td>514</td>
      <td>0.51</td>
    </tr>
    <tr>
      <th>Credit Score</th>
      <td>19668</td>
      <td>19.57</td>
    </tr>
    <tr>
      <th>Annual Income</th>
      <td>19668</td>
      <td>19.57</td>
    </tr>
    <tr>
      <th>Years in current job</th>
      <td>4736</td>
      <td>4.71</td>
    </tr>
    <tr>
      <th>Home Ownership</th>
      <td>514</td>
      <td>0.51</td>
    </tr>
    <tr>
      <th>Purpose</th>
      <td>514</td>
      <td>0.51</td>
    </tr>
    <tr>
      <th>Monthly Debt</th>
      <td>514</td>
      <td>0.51</td>
    </tr>
    <tr>
      <th>Years of Credit History</th>
      <td>514</td>
      <td>0.51</td>
    </tr>
    <tr>
      <th>Months since last delinquent</th>
      <td>53655</td>
      <td>53.38</td>
    </tr>
    <tr>
      <th>Number of Open Accounts</th>
      <td>514</td>
      <td>0.51</td>
    </tr>
    <tr>
      <th>Number of Credit Problems</th>
      <td>514</td>
      <td>0.51</td>
    </tr>
    <tr>
      <th>Current Credit Balance</th>
      <td>514</td>
      <td>0.51</td>
    </tr>
    <tr>
      <th>Maximum Open Credit</th>
      <td>516</td>
      <td>0.51</td>
    </tr>
    <tr>
      <th>Bankruptcies</th>
      <td>718</td>
      <td>0.71</td>
    </tr>
    <tr>
      <th>Tax Liens</th>
      <td>524</td>
      <td>0.52</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[21]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">missing</span><span class="o">=</span><span class="n">loan_eda</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="s1">&#39;missNum&#39;</span><span class="p">})</span>
<span class="n">missing</span><span class="p">[</span><span class="s1">&#39;missRate&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">missing</span><span class="p">[</span><span class="s1">&#39;missNum&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">loan_eda</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">miss_analy</span><span class="o">=</span><span class="n">missing</span><span class="p">[</span><span class="n">missing</span><span class="o">.</span><span class="n">missRate</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;missRate&#39;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[22]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">miss_analy</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">list</span><span class="p">(</span><span class="n">miss_analy</span><span class="o">.</span><span class="n">missRate</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="n">align</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="s1">&#39;green&#39;</span><span class="p">,</span><span class="s1">&#39;yellow&#39;</span><span class="p">,</span><span class="s1">&#39;steelblue&#39;</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Histogram of missing value of variables&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;variables names&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;missing rate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">miss_analy</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">list</span><span class="p">(</span><span class="n">miss_analy</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>

<span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">miss_analy</span><span class="o">.</span><span class="n">missRate</span><span class="o">.</span><span class="n">values</span><span class="p">)):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="mf">0.12</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">{:.2%}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y</span><span class="p">),</span><span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>    
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1>5. Machine Learning<a rel="noopener" class="anchor-link" href="#5.-Machine-Learning">&#182;</a></h1><ul>
<li>In the machine learning part, we firstly used 7 models in the preliminary analysis: logistic regression, gaussian naive bayes, decision tree, random forest, adaboost, gradient boost, and SVM with RBF kernel. In the final report, we selected four models - logistic regression, decision tree, random forest, and xgboost - and compared the performance - training accuracy, test accuracy, and AUROC score of those four models.</li>
<li>we paralleled three different datasets:<ul>
<li>dataset #1: remove any row with missing value ==&gt; baseline model.</li>
<li>dataset #2: drop column <strong>|Months since last delinquent|</strong>(with 53% missing rate) and then impute all missing values ==&gt; advanced model 01.</li>
<li>dataset #3: keep the column <strong>|Months since last delinquent|</strong>, use a fixed value(0) to replace the missing values ==&gt; advanced model 02.</li>
</ul>
</li>
<li>All three datasets are splited into 70%-30% training and test. The crossvalidation is set as 5 for hyperparameters tuning.</li>
<li>For scaling model like logistic regression, we performed standardization and for all three tree-based model, we used the dummy-encoding variables.</li>
<li>We also performed PCA for all three models. For Kernel PCA, the size of the dataset would trigger &quot;out-of-memory error&quot;.</li>
<li>The training score, test score, confusion matrix, and AUROC score are shown below. </li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[23]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">copy</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="c1"># imputation</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">KNNImputer</span>
<span class="kn">from</span> <span class="nn">sklearn.experimental</span> <span class="kn">import</span> <span class="n">enable_iterative_imputer</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">IterativeImputer</span>

<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">metrics</span>

<span class="c1"># model library</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>

<span class="c1"># Normalization</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
<span class="c1"># PCA</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>

<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">preprocessing</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBRegressor</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>5.1 Load Data<a rel="noopener" class="anchor-link" href="#5.1-Load-Data">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[24]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">loan</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;credit_train.csv&#39;</span><span class="p">)</span>

<span class="nb">print</span> <span class="p">(</span><span class="n">loan</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>

<span class="nb">print</span> <span class="p">(</span><span class="n">loan</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>

<span class="nb">print</span> <span class="p">(</span><span class="n">loan</span><span class="o">.</span><span class="n">dtypes</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>                                Loan ID                           Customer ID  \
0  14dd8831-6af5-400b-83ec-68e61888a048  981165ec-3274-42f5-a3b4-d104041a9ca9   
1  4771cc26-131a-45db-b5aa-537ea4ba5342  2de017a3-2e01-49cb-a581-08169e83be29   
2  4eed4e6a-aa2f-4c91-8651-ce984ee8fb26  5efb2b2b-bf11-4dfd-a572-3761a2694725   
3  77598f7b-32e7-4e3b-a6e5-06ba0d98fe8a  e777faab-98ae-45af-9a86-7ce5b33b1011   
4  d4062e70-befa-4995-8643-a0de73938182  81536ad9-5ccf-4eb8-befb-47a4d608658e   

  Loan Status  Current Loan Amount        Term  Credit Score  Annual Income  \
0  Fully Paid            445412.00  Short Term        709.00     1167493.00   
1  Fully Paid            262328.00  Short Term           nan            nan   
2  Fully Paid          99999999.00  Short Term        741.00     2231892.00   
3  Fully Paid            347666.00   Long Term        721.00      806949.00   
4  Fully Paid            176220.00  Short Term           nan            nan   

  Years in current job Home Ownership             Purpose  Monthly Debt  \
0              8 years  Home Mortgage   Home Improvements       5214.74   
1            10+ years  Home Mortgage  Debt Consolidation      33295.98   
2              8 years       Own Home  Debt Consolidation      29200.53   
3              3 years       Own Home  Debt Consolidation       8741.90   
4              5 years           Rent  Debt Consolidation      20639.70   

   Years of Credit History  Months since last delinquent  \
0                    17.20                           nan   
1                    21.10                          8.00   
2                    14.90                         29.00   
3                    12.00                           nan   
4                     6.10                           nan   

   Number of Open Accounts  Number of Credit Problems  Current Credit Balance  \
0                     6.00                       1.00               228190.00   
1                    35.00                       0.00               229976.00   
2                    18.00                       1.00               297996.00   
3                     9.00                       0.00               256329.00   
4                    15.00                       0.00               253460.00   

   Maximum Open Credit  Bankruptcies  Tax Liens  
0            416746.00          1.00       0.00  
1            850784.00          0.00       0.00  
2            750090.00          0.00       0.00  
3            386958.00          0.00       0.00  
4            427174.00          0.00       0.00  
------------------------------------------------------------
(100514, 19)
------------------------------------------------------------
Loan ID                          object
Customer ID                      object
Loan Status                      object
Current Loan Amount             float64
Term                             object
Credit Score                    float64
Annual Income                   float64
Years in current job             object
Home Ownership                   object
Purpose                          object
Monthly Debt                    float64
Years of Credit History         float64
Months since last delinquent    float64
Number of Open Accounts         float64
Number of Credit Problems       float64
Current Credit Balance          float64
Maximum Open Credit             float64
Bankruptcies                    float64
Tax Liens                       float64
dtype: object
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><h3>5.1.1 Get variable list<a rel="noopener" class="anchor-link" href="#5.1.1-Get-variable-list">&#182;</a></h3><ul>
<li>There are nonsense variables for our analysis: Loan ID and Customer ID are just unique key, maybe the foreign key for connecting with other databases. So, in this case, we just drop these two columns.</li>
</ul>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[25]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">drop_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Loan ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Customer ID&#39;</span><span class="p">]</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Shape before dropping:&#39;</span><span class="p">,</span> <span class="n">loan</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="n">loan</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">drop_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Shape after dropping:&#39;</span><span class="p">,</span> <span class="n">loan</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Shape before dropping: (100514, 19)
Shape after dropping: (100514, 17)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[26]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">target</span> <span class="o">=</span> <span class="s1">&#39;Loan Status&#39;</span>
<span class="nb">print</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Target variable is </span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>

<span class="n">categorical_attributes</span> <span class="o">=</span> <span class="n">loan</span><span class="o">.</span><span class="n">dtypes</span><span class="p">[</span><span class="n">loan</span><span class="o">.</span><span class="n">dtypes</span> <span class="o">==</span> <span class="nb">object</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">categorical_attributes</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Categorical Attributes: &#39;</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="o">*</span><span class="n">categorical_attributes</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;||&#39;</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Number of Categorical Attributes:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">categorical_attributes</span><span class="p">))</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>

<span class="n">numeric_attributes</span> <span class="o">=</span> <span class="n">loan</span><span class="o">.</span><span class="n">dtypes</span><span class="p">[</span><span class="n">loan</span><span class="o">.</span><span class="n">dtypes</span> <span class="o">!=</span> <span class="nb">object</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Numeric Attributes: &#39;</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="o">*</span><span class="n">numeric_attributes</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;||&#39;</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Number of Numeric Attributes:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">numeric_attributes</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Target variable is Loan Status.
------------------------------------------------------------
Categorical Attributes: 
Term||Years in current job||Home Ownership||Purpose
Number of Categorical Attributes: 4
------------------------------------------------------------
Numeric Attributes: 
Current Loan Amount||Credit Score||Annual Income||Monthly Debt||Years of Credit History||Months since last delinquent||Number of Open Accounts||Number of Credit Problems||Current Credit Balance||Maximum Open Credit||Bankruptcies||Tax Liens
------------------------------------------------------------
Number of Numeric Attributes: 12
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[27]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">loan_ori</span> <span class="o">=</span> <span class="n">loan</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1"># keep the original data</span>
<span class="n">loan_baseline</span> <span class="o">=</span> <span class="n">loan</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1"># the dataset for baseline model 01</span>

<span class="n">loan_advanced01</span> <span class="o">=</span> <span class="n">loan</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1"># the dataset for advanced model 01</span>
<span class="n">loan_advanced02</span> <span class="o">=</span> <span class="n">loan</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1"># the dataset for advanced model 02</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>5.2 Missing Analysis and Imputation<a rel="noopener" class="anchor-link" href="#5.2-Missing-Analysis-and-Imputation">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><h3>5.2.1 For baseline model 01 - Removing all missing rows<a rel="noopener" class="anchor-link" href="#5.2.1-For-baseline-model-01---Removing-all-missing-rows">&#182;</a></h3>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[28]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Missing count: </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">loan_baseline</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Missing count: 
 Loan Status                       514
Current Loan Amount               514
Term                              514
Credit Score                    19668
Annual Income                   19668
Years in current job             4736
Home Ownership                    514
Purpose                           514
Monthly Debt                      514
Years of Credit History           514
Months since last delinquent    53655
Number of Open Accounts           514
Number of Credit Problems         514
Current Credit Balance            514
Maximum Open Credit               516
Bankruptcies                      718
Tax Liens                         524
dtype: int64
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[29]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Shape before dropping:&#39;</span><span class="p">,</span> <span class="n">loan_baseline</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">loan_baseline</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Shape after dropping:&#39;</span><span class="p">,</span> <span class="n">loan_baseline</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Shape before dropping: (100514, 17)
Shape after dropping: (36423, 17)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[30]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Missing count: </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">loan_baseline</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Missing count: 
 Loan Status                     0
Current Loan Amount             0
Term                            0
Credit Score                    0
Annual Income                   0
Years in current job            0
Home Ownership                  0
Purpose                         0
Monthly Debt                    0
Years of Credit History         0
Months since last delinquent    0
Number of Open Accounts         0
Number of Credit Problems       0
Current Credit Balance          0
Maximum Open Credit             0
Bankruptcies                    0
Tax Liens                       0
dtype: int64
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[31]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">loan_baseline</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[31]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Loan Status</th>
      <th>Current Loan Amount</th>
      <th>Term</th>
      <th>Credit Score</th>
      <th>Annual Income</th>
      <th>Years in current job</th>
      <th>Home Ownership</th>
      <th>Purpose</th>
      <th>Monthly Debt</th>
      <th>Years of Credit History</th>
      <th>Months since last delinquent</th>
      <th>Number of Open Accounts</th>
      <th>Number of Credit Problems</th>
      <th>Current Credit Balance</th>
      <th>Maximum Open Credit</th>
      <th>Bankruptcies</th>
      <th>Tax Liens</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>Fully Paid</td>
      <td>99999999.00</td>
      <td>Short Term</td>
      <td>741.00</td>
      <td>2231892.00</td>
      <td>8 years</td>
      <td>Own Home</td>
      <td>Debt Consolidation</td>
      <td>29200.53</td>
      <td>14.90</td>
      <td>29.00</td>
      <td>18.00</td>
      <td>1.00</td>
      <td>297996.00</td>
      <td>750090.00</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Fully Paid</td>
      <td>217646.00</td>
      <td>Short Term</td>
      <td>730.00</td>
      <td>1184194.00</td>
      <td>&lt; 1 year</td>
      <td>Home Mortgage</td>
      <td>Debt Consolidation</td>
      <td>10855.08</td>
      <td>19.60</td>
      <td>10.00</td>
      <td>13.00</td>
      <td>1.00</td>
      <td>122170.00</td>
      <td>272052.00</td>
      <td>1.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Fully Paid</td>
      <td>548746.00</td>
      <td>Short Term</td>
      <td>678.00</td>
      <td>2559110.00</td>
      <td>2 years</td>
      <td>Rent</td>
      <td>Debt Consolidation</td>
      <td>18660.28</td>
      <td>22.60</td>
      <td>33.00</td>
      <td>4.00</td>
      <td>0.00</td>
      <td>437171.00</td>
      <td>555038.00</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Fully Paid</td>
      <td>99999999.00</td>
      <td>Short Term</td>
      <td>728.00</td>
      <td>714628.00</td>
      <td>3 years</td>
      <td>Rent</td>
      <td>Debt Consolidation</td>
      <td>11851.06</td>
      <td>16.00</td>
      <td>76.00</td>
      <td>16.00</td>
      <td>0.00</td>
      <td>203965.00</td>
      <td>289784.00</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Fully Paid</td>
      <td>99999999.00</td>
      <td>Short Term</td>
      <td>740.00</td>
      <td>776188.00</td>
      <td>&lt; 1 year</td>
      <td>Own Home</td>
      <td>Debt Consolidation</td>
      <td>11578.22</td>
      <td>8.50</td>
      <td>25.00</td>
      <td>6.00</td>
      <td>0.00</td>
      <td>134083.00</td>
      <td>220220.00</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[32]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">loan_baseline</span><span class="p">[</span><span class="s1">&#39;Loan Status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">loan_baseline</span><span class="p">[</span><span class="s1">&#39;Loan Status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s1">&#39;Charged Off&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Fully Paid&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>

<span class="n">loan_baseline_dummy</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">loan_baseline</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">loan_baseline_dummy</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>(36423, 46)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[33]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">loan_baseline_dummy</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[33]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Loan Status</th>
      <th>Current Loan Amount</th>
      <th>Credit Score</th>
      <th>Annual Income</th>
      <th>Monthly Debt</th>
      <th>Years of Credit History</th>
      <th>Months since last delinquent</th>
      <th>Number of Open Accounts</th>
      <th>Number of Credit Problems</th>
      <th>Current Credit Balance</th>
      <th>...</th>
      <th>Purpose_Medical Bills</th>
      <th>Purpose_Other</th>
      <th>Purpose_Take a Trip</th>
      <th>Purpose_major_purchase</th>
      <th>Purpose_moving</th>
      <th>Purpose_other</th>
      <th>Purpose_renewable_energy</th>
      <th>Purpose_small_business</th>
      <th>Purpose_vacation</th>
      <th>Purpose_wedding</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>99999999.00</td>
      <td>741.00</td>
      <td>2231892.00</td>
      <td>29200.53</td>
      <td>14.90</td>
      <td>29.00</td>
      <td>18.00</td>
      <td>1.00</td>
      <td>297996.00</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0</td>
      <td>217646.00</td>
      <td>730.00</td>
      <td>1184194.00</td>
      <td>10855.08</td>
      <td>19.60</td>
      <td>10.00</td>
      <td>13.00</td>
      <td>1.00</td>
      <td>122170.00</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0</td>
      <td>548746.00</td>
      <td>678.00</td>
      <td>2559110.00</td>
      <td>18660.28</td>
      <td>22.60</td>
      <td>33.00</td>
      <td>4.00</td>
      <td>0.00</td>
      <td>437171.00</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0</td>
      <td>99999999.00</td>
      <td>728.00</td>
      <td>714628.00</td>
      <td>11851.06</td>
      <td>16.00</td>
      <td>76.00</td>
      <td>16.00</td>
      <td>0.00</td>
      <td>203965.00</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>0</td>
      <td>99999999.00</td>
      <td>740.00</td>
      <td>776188.00</td>
      <td>11578.22</td>
      <td>8.50</td>
      <td>25.00</td>
      <td>6.00</td>
      <td>0.00</td>
      <td>134083.00</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>5 rows &#215; 46 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><h3>5.2.2 For advanced model01 - imputation<a rel="noopener" class="anchor-link" href="#5.2.2-For-advanced-model01---imputation">&#182;</a></h3>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[34]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="nb">print</span> <span class="p">(</span><span class="n">loan_advanced01</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">loan_advanced01</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>(100514, 17)
------------------------------------------------------------
Loan Status                       514
Current Loan Amount               514
Term                              514
Credit Score                    19668
Annual Income                   19668
Years in current job             4736
Home Ownership                    514
Purpose                           514
Monthly Debt                      514
Years of Credit History           514
Months since last delinquent    53655
Number of Open Accounts           514
Number of Credit Problems         514
Current Credit Balance            514
Maximum Open Credit               516
Bankruptcies                      718
Tax Liens                         524
dtype: int64
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Notice here, all columns are with missing, and there is one value 514 within 10 columns. This might be represents all of these rows are with missing.</li>
<li><strong>Solution: remove the rows if the rows are fully missing, and then check missing rate again.</strong></li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[35]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># loan without all rows are missing</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Shape before removing: &#39;</span><span class="p">,</span> <span class="n">loan_advanced01</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">loan_advanced01</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Shape after removing: &#39;</span><span class="p">,</span><span class="n">loan_advanced01</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>

<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Missing count: </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">loan_advanced01</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Shape before removing:  (100514, 17)
Shape after removing:  (100000, 17)
------------------------------------------------------------
Missing count: 
 Loan Status                         0
Current Loan Amount                 0
Term                                0
Credit Score                    19154
Annual Income                   19154
Years in current job             4222
Home Ownership                      0
Purpose                             0
Monthly Debt                        0
Years of Credit History             0
Months since last delinquent    53141
Number of Open Accounts             0
Number of Credit Problems           0
Current Credit Balance              0
Maximum Open Credit                 2
Bankruptcies                      204
Tax Liens                          10
dtype: int64
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[36]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Missing rate: </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">loan_advanced01</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Missing rate: 
 Loan Status                    0.00
Current Loan Amount            0.00
Term                           0.00
Credit Score                   0.19
Annual Income                  0.19
Years in current job           0.04
Home Ownership                 0.00
Purpose                        0.00
Monthly Debt                   0.00
Years of Credit History        0.00
Months since last delinquent   0.53
Number of Open Accounts        0.00
Number of Credit Problems      0.00
Current Credit Balance         0.00
Maximum Open Credit            0.00
Bankruptcies                   0.00
Tax Liens                      0.00
dtype: float64
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Now, there is only one categorical attribute, Years in current job, has missing.</li>
<li>there are 6 numeric attributes with missing. One of them, Months since last delinquent, has a missing rate 0.53141 which is larger than 30%. Therefore, we are going to drop this column directly.</li>
<li>And for the remaining numeric attributes with missing, we are going to impute.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[37]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Shape before removing: &#39;</span><span class="p">,</span> <span class="n">loan_advanced01</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">loan_advanced01</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Months since last delinquent&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Shape after removing: &#39;</span><span class="p">,</span><span class="n">loan_advanced01</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Shape before removing:  (100000, 17)
Shape after removing:  (100000, 16)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>there are few columns with weird values which are contradicted with our common sense or knowledge. Therefore, we believe those weird values are made by :<ul>
<li>applicant delibrate hidding</li>
<li>some error during the integration of database</li>
<li>customer service input error</li>
<li>use some extreme numbers to represent missing.</li>
</ul>
</li>
<li>another solution is to <strong>drop</strong> these weird rows.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><p><strong>| Current Loan Amount |</strong></p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[38]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># count how many weird values</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Count:&#39;</span><span class="p">,</span><span class="n">loan_advanced01</span><span class="p">[</span><span class="s1">&#39;Current Loan Amount&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mf">99999999.0</span><span class="p">))</span>

<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Type before replacement:&#39;</span><span class="p">,</span> <span class="n">loan_advanced01</span><span class="p">[</span><span class="s1">&#39;Current Loan Amount&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

<span class="n">loan_advanced01</span><span class="p">[</span><span class="s1">&#39;Current Loan Amount&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">loan_advanced01</span><span class="p">[</span><span class="s1">&#39;Current Loan Amount&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="mf">99999999.0</span><span class="p">],</span> <span class="s1">&#39;NaN&#39;</span><span class="p">)</span> <span class="c1"># replace the 99999999.0 with NaN</span>

<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Type after replacement:&#39;</span><span class="p">,</span> <span class="n">loan_advanced01</span><span class="p">[</span><span class="s1">&#39;Current Loan Amount&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Count: 11484
Type before replacement: float64
Type after replacement: object
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>After adding NaN, the type of that column, Current Loan Amount, has changed from numeric(float64) to categorical(object), therefore, the first thing we need to do for missing checking is to change the type of that column.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[39]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">loan_advanced01</span> <span class="o">=</span> <span class="n">loan_advanced01</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="s1">&#39;Current Loan Amount&#39;</span><span class="p">:</span> <span class="s1">&#39;float64&#39;</span><span class="p">})</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">loan_advanced01</span><span class="p">[</span><span class="s1">&#39;Current Loan Amount&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>float64
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[40]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># check missing of this column only</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">loan_advanced01</span><span class="p">[</span><span class="s1">&#39;Current Loan Amount&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">loan_advanced01</span><span class="p">[</span><span class="s1">&#39;Current Loan Amount&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>11484
0.11484
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><p><strong>| Credit Score |</strong></p>
<ul>
<li>We also found within the column Credit Score, there are values more than 1000, which contradicts the life experience... and majority of such weird values are at least more than 5000. Therefore, we use this as threshold, and any values above this threshold are considered as missing.</li>
</ul>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[41]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># show the boxplot</span>
<span class="n">loan_advanced01</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Credit Score&#39;</span><span class="p">],</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Within the above boxplot, we find the extreme value are more than 5000.</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[42]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># count how many weird values</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Count:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">loan_advanced01</span><span class="p">[</span><span class="s1">&#39;Credit Score&#39;</span><span class="p">][</span><span class="n">loan_advanced01</span><span class="p">[</span><span class="s1">&#39;Credit Score&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">5000</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Count: 4551
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[43]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Type before replacement:&#39;</span><span class="p">,</span> <span class="n">loan_advanced01</span><span class="p">[</span><span class="s1">&#39;Credit Score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

<span class="n">loan_advanced01</span><span class="p">[</span><span class="s1">&#39;Credit Score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">loan_advanced01</span><span class="p">[</span><span class="s1">&#39;Credit Score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)],</span> <span class="s1">&#39;NaN&#39;</span><span class="p">)</span> <span class="c1"># replace &gt;= 5000 with NaN</span>

<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Type after replacement:&#39;</span><span class="p">,</span> <span class="n">loan_advanced01</span><span class="p">[</span><span class="s1">&#39;Credit Score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Type before replacement: float64
Type after replacement: object
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[44]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">loan_advanced01</span> <span class="o">=</span> <span class="n">loan_advanced01</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="s1">&#39;Credit Score&#39;</span><span class="p">:</span> <span class="s1">&#39;float64&#39;</span><span class="p">})</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">loan_advanced01</span><span class="p">[</span><span class="s1">&#39;Credit Score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>float64
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[45]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># check missing of this column only</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">loan_advanced01</span><span class="p">[</span><span class="s1">&#39;Credit Score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">loan_advanced01</span><span class="p">[</span><span class="s1">&#39;Credit Score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>23705
0.23705
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><p><strong>convert target varaible, |Loan Status|</strong></p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[46]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Before:&#39;</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">loan_advanced01</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>

<span class="n">loan_advanced01</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">if</span> <span class="n">out</span><span class="o">==</span><span class="s1">&#39;Charged Off&#39;</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">out</span> <span class="ow">in</span> <span class="n">loan_advanced01</span><span class="p">[</span><span class="s1">&#39;Loan Status&#39;</span><span class="p">]]</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;After:&#39;</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">loan_advanced01</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Before:
Fully Paid     77361
Charged Off    22639
Name: Loan Status, dtype: int64
------------------------------------------------------------
After:
0    77361
1    22639
Name: target, dtype: int64
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[47]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># remove the original column - Loan Status</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Shape before dropping:&#39;</span><span class="p">,</span> <span class="n">loan_advanced01</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="n">loan_advanced01</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;Loan Status&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Shape after dropping:&#39;</span><span class="p">,</span> <span class="n">loan_advanced01</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Shape before dropping: (100000, 17)
Shape after dropping: (100000, 16)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><p><strong>Change the subtypes of |Home Ownership|</strong></p>
<ul>
<li>merging HomeMortgage and Have Mortgage into Mortgage.</li>
</ul>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[48]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Before:&#39;</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">loan_advanced01</span><span class="p">[</span><span class="s1">&#39;Home Ownership&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>

<span class="n">loan_advanced01</span><span class="p">[</span><span class="s1">&#39;Home Ownership&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">loan_advanced01</span><span class="p">[</span><span class="s1">&#39;Home Ownership&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="s1">&#39;HaveMortgage&#39;</span><span class="p">,</span> <span class="s1">&#39;Home Mortgage&#39;</span><span class="p">],</span> <span class="s1">&#39;Mortgage&#39;</span><span class="p">)</span>

<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;After:&#39;</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">loan_advanced01</span><span class="p">[</span><span class="s1">&#39;Home Ownership&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Before:
Home Mortgage    48410
Rent             42194
Own Home          9182
HaveMortgage       214
Name: Home Ownership, dtype: int64
------------------------------------------------------------
After:
Mortgage    48624
Rent        42194
Own Home     9182
Name: Home Ownership, dtype: int64
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><h3>Missing Imputation<a rel="noopener" class="anchor-link" href="#Missing-Imputation">&#182;</a></h3>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[49]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">loan_advanced01</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[49]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>(100000, 16)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[50]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">target</span> <span class="o">=</span> <span class="s1">&#39;target&#39;</span>
<span class="nb">print</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Target variable is </span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>

<span class="n">categorical_attributes</span> <span class="o">=</span> <span class="n">loan_advanced01</span><span class="o">.</span><span class="n">dtypes</span><span class="p">[</span><span class="n">loan_advanced01</span><span class="o">.</span><span class="n">dtypes</span> <span class="o">==</span> <span class="nb">object</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Categorical Attributes: &#39;</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="o">*</span><span class="n">categorical_attributes</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;||&#39;</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Number of Categorical Attributes:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">categorical_attributes</span><span class="p">))</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>

<span class="n">numeric_attributes</span> <span class="o">=</span> <span class="n">loan_advanced01</span><span class="o">.</span><span class="n">dtypes</span><span class="p">[</span><span class="n">loan_advanced01</span><span class="o">.</span><span class="n">dtypes</span> <span class="o">!=</span> <span class="nb">object</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">numeric_attributes</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Numeric Attributes: &#39;</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="o">*</span><span class="n">numeric_attributes</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;||&#39;</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Number of Numeric Attributes:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">numeric_attributes</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Target variable is target.
------------------------------------------------------------
Categorical Attributes: 
Term||Years in current job||Home Ownership||Purpose
Number of Categorical Attributes: 4
------------------------------------------------------------
Numeric Attributes: 
Current Loan Amount||Credit Score||Annual Income||Monthly Debt||Years of Credit History||Number of Open Accounts||Number of Credit Problems||Current Credit Balance||Maximum Open Credit||Bankruptcies||Tax Liens
------------------------------------------------------------
Number of Numeric Attributes: 11
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[51]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># check missing</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">loan_advanced01</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>

<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">loan_advanced01</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Current Loan Amount          11484
Term                             0
Credit Score                 23705
Annual Income                19154
Years in current job          4222
Home Ownership                   0
Purpose                          0
Monthly Debt                     0
Years of Credit History          0
Number of Open Accounts          0
Number of Credit Problems        0
Current Credit Balance           0
Maximum Open Credit              2
Bankruptcies                   204
Tax Liens                       10
target                           0
dtype: int64
------------------------------------------------------------
Current Loan Amount         0.11
Term                        0.00
Credit Score                0.24
Annual Income               0.19
Years in current job        0.04
Home Ownership              0.00
Purpose                     0.00
Monthly Debt                0.00
Years of Credit History     0.00
Number of Open Accounts     0.00
Number of Credit Problems   0.00
Current Credit Balance      0.00
Maximum Open Credit         0.00
Bankruptcies                0.00
Tax Liens                   0.00
target                      0.00
dtype: float64
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><p>Fillin categorical missing - Intuition</p>
<ul>
<li>there are two common way of categorical imputation:<ul>
<li>use the most common one.</li>
<li>use the unknow for missing. =&gt; create a new category.
<a rel="noopener" href="https://jamesrledoux.com/code/imputation#:~:text=One%20approach%20to%20imputing%20categorical,given%20in%20Pandas&#39;%20value_counts%20function">https://jamesrledoux.com/code/imputation#:~:text=One%20approach%20to%20imputing%20categorical,given%20in%20Pandas&#39;%20value_counts%20function</a>.</li>
</ul>
</li>
<li>in this case, we will use the <strong>first</strong> method. BUT, we can always perform the second method and compare.</li>
</ul>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[52]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;missing count:&#39;</span><span class="p">,</span> <span class="n">loan_advanced01</span><span class="p">[</span><span class="s1">&#39;Years in current job&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>

<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">loan_advanced01</span><span class="p">[</span><span class="s1">&#39;Years in current job&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>missing count: 4222
------------------------------------------------------------
10+ years    31121
2 years       9134
3 years       8169
&lt; 1 year      8164
5 years       6787
1 year        6460
4 years       6143
6 years       5686
7 years       5577
8 years       4582
9 years       3955
Name: Years in current job, dtype: int64
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[53]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">most_common</span> <span class="o">=</span> <span class="n">loan_advanced01</span><span class="p">[</span><span class="s1">&#39;Years in current job&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">most_common</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>10+ years
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[54]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">loan_advanced01</span><span class="p">[</span><span class="s1">&#39;Years in current job&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">most_common</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">loan_advanced01</span><span class="p">[</span><span class="s1">&#39;Years in current job&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>10+ years    35343
2 years       9134
3 years       8169
&lt; 1 year      8164
5 years       6787
1 year        6460
4 years       6143
6 years       5686
7 years       5577
8 years       4582
9 years       3955
Name: Years in current job, dtype: int64
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>In our preliminary analysis, we found dataset generated by MICE imputation had a better performance than KNN with a faster speed. Therefore, we decided to only use MICE in our final report models.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><h3>Mice Imputation<a rel="noopener" class="anchor-link" href="#Mice-Imputation">&#182;</a></h3><ul>
<li>reference
<a rel="noopener" href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3074241/#:~:text=Missing%20data%20are%20a%20common,method%20of%20addressing%20missing%20data">https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3074241/#:~:text=Missing%20data%20are%20a%20common,method%20of%20addressing%20missing%20data</a>.
<a rel="noopener" href="https://stats.stackexchange.com/questions/421545/multiple-imputation-by-chained-equations-mice-explained">https://stats.stackexchange.com/questions/421545/multiple-imputation-by-chained-equations-mice-explained</a></li>
</ul>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[55]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">loan_advanced01</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">loan_advanced01</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span>

<span class="nb">print</span> <span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>

<span class="n">X_dummy</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">X_dummy</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>

<span class="n">column_name</span> <span class="o">=</span> <span class="n">X_dummy</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">column_name</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>(100000, 15) (100000,)
------------------------------------------------------------
(100000, 43)
------------------------------------------------------------
[&#39;Current Loan Amount&#39;, &#39;Credit Score&#39;, &#39;Annual Income&#39;, &#39;Monthly Debt&#39;, &#39;Years of Credit History&#39;, &#39;Number of Open Accounts&#39;, &#39;Number of Credit Problems&#39;, &#39;Current Credit Balance&#39;, &#39;Maximum Open Credit&#39;, &#39;Bankruptcies&#39;, &#39;Tax Liens&#39;, &#39;Term_Long Term&#39;, &#39;Term_Short Term&#39;, &#39;Years in current job_1 year&#39;, &#39;Years in current job_10+ years&#39;, &#39;Years in current job_2 years&#39;, &#39;Years in current job_3 years&#39;, &#39;Years in current job_4 years&#39;, &#39;Years in current job_5 years&#39;, &#39;Years in current job_6 years&#39;, &#39;Years in current job_7 years&#39;, &#39;Years in current job_8 years&#39;, &#39;Years in current job_9 years&#39;, &#39;Years in current job_&lt; 1 year&#39;, &#39;Home Ownership_Mortgage&#39;, &#39;Home Ownership_Own Home&#39;, &#39;Home Ownership_Rent&#39;, &#39;Purpose_Business Loan&#39;, &#39;Purpose_Buy House&#39;, &#39;Purpose_Buy a Car&#39;, &#39;Purpose_Debt Consolidation&#39;, &#39;Purpose_Educational Expenses&#39;, &#39;Purpose_Home Improvements&#39;, &#39;Purpose_Medical Bills&#39;, &#39;Purpose_Other&#39;, &#39;Purpose_Take a Trip&#39;, &#39;Purpose_major_purchase&#39;, &#39;Purpose_moving&#39;, &#39;Purpose_other&#39;, &#39;Purpose_renewable_energy&#39;, &#39;Purpose_small_business&#39;, &#39;Purpose_vacation&#39;, &#39;Purpose_wedding&#39;]
------------------------------------------------------------
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[56]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">imputer</span> <span class="o">=</span> <span class="n">IterativeImputer</span><span class="p">()</span>
<span class="n">X_dummy_mice</span> <span class="o">=</span> <span class="n">imputer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_dummy</span><span class="p">)</span>

<span class="c1"># convert to dataframe</span>
<span class="n">X_dummy_mice_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">X_dummy_mice</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">column_name</span><span class="p">)</span>
<span class="n">X_dummy_mice_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Wall time: 45 s
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt output_prompt">Out[56]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Current Loan Amount</th>
      <th>Credit Score</th>
      <th>Annual Income</th>
      <th>Monthly Debt</th>
      <th>Years of Credit History</th>
      <th>Number of Open Accounts</th>
      <th>Number of Credit Problems</th>
      <th>Current Credit Balance</th>
      <th>Maximum Open Credit</th>
      <th>Bankruptcies</th>
      <th>...</th>
      <th>Purpose_Medical Bills</th>
      <th>Purpose_Other</th>
      <th>Purpose_Take a Trip</th>
      <th>Purpose_major_purchase</th>
      <th>Purpose_moving</th>
      <th>Purpose_other</th>
      <th>Purpose_renewable_energy</th>
      <th>Purpose_small_business</th>
      <th>Purpose_vacation</th>
      <th>Purpose_wedding</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>445412.00</td>
      <td>709.00</td>
      <td>1167493.00</td>
      <td>5214.74</td>
      <td>17.20</td>
      <td>6.00</td>
      <td>1.00</td>
      <td>228190.00</td>
      <td>416746.00</td>
      <td>1.00</td>
      <td>...</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>262328.00</td>
      <td>728.40</td>
      <td>1476369.15</td>
      <td>33295.98</td>
      <td>21.10</td>
      <td>35.00</td>
      <td>0.00</td>
      <td>229976.00</td>
      <td>850784.00</td>
      <td>0.00</td>
      <td>...</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>313983.74</td>
      <td>741.00</td>
      <td>2231892.00</td>
      <td>29200.53</td>
      <td>14.90</td>
      <td>18.00</td>
      <td>1.00</td>
      <td>297996.00</td>
      <td>750090.00</td>
      <td>0.00</td>
      <td>...</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>3</th>
      <td>347666.00</td>
      <td>721.00</td>
      <td>806949.00</td>
      <td>8741.90</td>
      <td>12.00</td>
      <td>9.00</td>
      <td>0.00</td>
      <td>256329.00</td>
      <td>386958.00</td>
      <td>0.00</td>
      <td>...</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>4</th>
      <td>176220.00</td>
      <td>721.17</td>
      <td>1078625.35</td>
      <td>20639.70</td>
      <td>6.10</td>
      <td>15.00</td>
      <td>0.00</td>
      <td>253460.00</td>
      <td>427174.00</td>
      <td>0.00</td>
      <td>...</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
  </tbody>
</table>
<p>5 rows &#215; 43 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[57]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">loan_advanced01_mice</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">X_dummy_mice_df</span><span class="p">,</span> <span class="n">y</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">loan_advanced01_mice</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[57]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Current Loan Amount</th>
      <th>Credit Score</th>
      <th>Annual Income</th>
      <th>Monthly Debt</th>
      <th>Years of Credit History</th>
      <th>Number of Open Accounts</th>
      <th>Number of Credit Problems</th>
      <th>Current Credit Balance</th>
      <th>Maximum Open Credit</th>
      <th>Bankruptcies</th>
      <th>...</th>
      <th>Purpose_Other</th>
      <th>Purpose_Take a Trip</th>
      <th>Purpose_major_purchase</th>
      <th>Purpose_moving</th>
      <th>Purpose_other</th>
      <th>Purpose_renewable_energy</th>
      <th>Purpose_small_business</th>
      <th>Purpose_vacation</th>
      <th>Purpose_wedding</th>
      <th>target</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>445412.00</td>
      <td>709.00</td>
      <td>1167493.00</td>
      <td>5214.74</td>
      <td>17.20</td>
      <td>6.00</td>
      <td>1.00</td>
      <td>228190.00</td>
      <td>416746.00</td>
      <td>1.00</td>
      <td>...</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>262328.00</td>
      <td>728.40</td>
      <td>1476369.15</td>
      <td>33295.98</td>
      <td>21.10</td>
      <td>35.00</td>
      <td>0.00</td>
      <td>229976.00</td>
      <td>850784.00</td>
      <td>0.00</td>
      <td>...</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>313983.74</td>
      <td>741.00</td>
      <td>2231892.00</td>
      <td>29200.53</td>
      <td>14.90</td>
      <td>18.00</td>
      <td>1.00</td>
      <td>297996.00</td>
      <td>750090.00</td>
      <td>0.00</td>
      <td>...</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>347666.00</td>
      <td>721.00</td>
      <td>806949.00</td>
      <td>8741.90</td>
      <td>12.00</td>
      <td>9.00</td>
      <td>0.00</td>
      <td>256329.00</td>
      <td>386958.00</td>
      <td>0.00</td>
      <td>...</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>176220.00</td>
      <td>721.17</td>
      <td>1078625.35</td>
      <td>20639.70</td>
      <td>6.10</td>
      <td>15.00</td>
      <td>0.00</td>
      <td>253460.00</td>
      <td>427174.00</td>
      <td>0.00</td>
      <td>...</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>5 rows &#215; 44 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><h3>5.2.3 For advanced model02<a rel="noopener" class="anchor-link" href="#5.2.3-For-advanced-model02">&#182;</a></h3><ul>
<li>use fixed value (0) for missing in <strong>Months since last delinquent</strong></li>
</ul>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[58]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="nb">print</span> <span class="p">(</span><span class="n">loan_advanced02</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>

<span class="nb">print</span> <span class="p">(</span><span class="n">loan_advanced02</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>(100514, 17)
------------------------------------------------------------
Loan Status                       514
Current Loan Amount               514
Term                              514
Credit Score                    19668
Annual Income                   19668
Years in current job             4736
Home Ownership                    514
Purpose                           514
Monthly Debt                      514
Years of Credit History           514
Months since last delinquent    53655
Number of Open Accounts           514
Number of Credit Problems         514
Current Credit Balance            514
Maximum Open Credit               516
Bankruptcies                      718
Tax Liens                         524
dtype: int64
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[59]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">values</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Months since last delinquent&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span> <span class="c1"># fixed value for Months since last deliquent</span>
<span class="n">loan_advanced02</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">values</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">loan_advanced02</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[59]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>Loan Status                       514
Current Loan Amount               514
Term                              514
Credit Score                    19668
Annual Income                   19668
Years in current job             4736
Home Ownership                    514
Purpose                           514
Monthly Debt                      514
Years of Credit History           514
Months since last delinquent        0
Number of Open Accounts           514
Number of Credit Problems         514
Current Credit Balance            514
Maximum Open Credit               516
Bankruptcies                      718
Tax Liens                         524
dtype: int64</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[60]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">loan_advanced02</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">loan_advanced02</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>

<span class="nb">print</span> <span class="p">(</span><span class="n">loan_advanced02</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>(77271, 17)
------------------------------------------------------------
Loan Status                     0
Current Loan Amount             0
Term                            0
Credit Score                    0
Annual Income                   0
Years in current job            0
Home Ownership                  0
Purpose                         0
Monthly Debt                    0
Years of Credit History         0
Months since last delinquent    0
Number of Open Accounts         0
Number of Credit Problems       0
Current Credit Balance          0
Maximum Open Credit             0
Bankruptcies                    0
Tax Liens                       0
dtype: int64
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[61]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># remove all rows where Current Loan Amount equals to 999999999</span>
<span class="n">loan_advanced02</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">loan_advanced02</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">loan</span><span class="p">[</span><span class="s1">&#39;Current Loan Amount&#39;</span><span class="p">]</span><span class="o">==</span><span class="mf">99999999.0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">loan_advanced02</span><span class="p">[</span><span class="s1">&#39;Annual Income&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">loan_advanced02</span><span class="p">[</span><span class="s1">&#39;Annual Income&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span> 

<span class="n">loan_advanced02</span><span class="p">[</span><span class="s1">&#39;Loan Status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">loan_advanced02</span><span class="p">[</span><span class="s1">&#39;Loan Status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s1">&#39;Charged Off&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Fully Paid&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[62]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">loan_advanced02_dummy</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">loan_advanced02</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">loan_advanced02_dummy</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="nb">print</span> <span class="p">(</span><span class="n">loan_advanced02_dummy</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>(66242, 46)
[&#39;Loan Status&#39;, &#39;Current Loan Amount&#39;, &#39;Credit Score&#39;, &#39;Annual Income&#39;, &#39;Monthly Debt&#39;, &#39;Years of Credit History&#39;, &#39;Months since last delinquent&#39;, &#39;Number of Open Accounts&#39;, &#39;Number of Credit Problems&#39;, &#39;Current Credit Balance&#39;, &#39;Maximum Open Credit&#39;, &#39;Bankruptcies&#39;, &#39;Tax Liens&#39;, &#39;Term_Long Term&#39;, &#39;Term_Short Term&#39;, &#39;Years in current job_1 year&#39;, &#39;Years in current job_10+ years&#39;, &#39;Years in current job_2 years&#39;, &#39;Years in current job_3 years&#39;, &#39;Years in current job_4 years&#39;, &#39;Years in current job_5 years&#39;, &#39;Years in current job_6 years&#39;, &#39;Years in current job_7 years&#39;, &#39;Years in current job_8 years&#39;, &#39;Years in current job_9 years&#39;, &#39;Years in current job_&lt; 1 year&#39;, &#39;Home Ownership_HaveMortgage&#39;, &#39;Home Ownership_Home Mortgage&#39;, &#39;Home Ownership_Own Home&#39;, &#39;Home Ownership_Rent&#39;, &#39;Purpose_Business Loan&#39;, &#39;Purpose_Buy House&#39;, &#39;Purpose_Buy a Car&#39;, &#39;Purpose_Debt Consolidation&#39;, &#39;Purpose_Educational Expenses&#39;, &#39;Purpose_Home Improvements&#39;, &#39;Purpose_Medical Bills&#39;, &#39;Purpose_Other&#39;, &#39;Purpose_Take a Trip&#39;, &#39;Purpose_major_purchase&#39;, &#39;Purpose_moving&#39;, &#39;Purpose_other&#39;, &#39;Purpose_renewable_energy&#39;, &#39;Purpose_small_business&#39;, &#39;Purpose_vacation&#39;, &#39;Purpose_wedding&#39;]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[63]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">loan_advanced02_dummy</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[63]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Loan Status</th>
      <th>Current Loan Amount</th>
      <th>Credit Score</th>
      <th>Annual Income</th>
      <th>Monthly Debt</th>
      <th>Years of Credit History</th>
      <th>Months since last delinquent</th>
      <th>Number of Open Accounts</th>
      <th>Number of Credit Problems</th>
      <th>Current Credit Balance</th>
      <th>...</th>
      <th>Purpose_Medical Bills</th>
      <th>Purpose_Other</th>
      <th>Purpose_Take a Trip</th>
      <th>Purpose_major_purchase</th>
      <th>Purpose_moving</th>
      <th>Purpose_other</th>
      <th>Purpose_renewable_energy</th>
      <th>Purpose_small_business</th>
      <th>Purpose_vacation</th>
      <th>Purpose_wedding</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>445412.00</td>
      <td>709.00</td>
      <td>1167493</td>
      <td>5214.74</td>
      <td>17.20</td>
      <td>0.00</td>
      <td>6.00</td>
      <td>1.00</td>
      <td>228190.00</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>347666.00</td>
      <td>721.00</td>
      <td>806949</td>
      <td>8741.90</td>
      <td>12.00</td>
      <td>0.00</td>
      <td>9.00</td>
      <td>0.00</td>
      <td>256329.00</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1</td>
      <td>206602.00</td>
      <td>7290.00</td>
      <td>896857</td>
      <td>16367.74</td>
      <td>17.30</td>
      <td>0.00</td>
      <td>6.00</td>
      <td>0.00</td>
      <td>215308.00</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0</td>
      <td>217646.00</td>
      <td>730.00</td>
      <td>1184194</td>
      <td>10855.08</td>
      <td>19.60</td>
      <td>10.00</td>
      <td>13.00</td>
      <td>1.00</td>
      <td>122170.00</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0</td>
      <td>548746.00</td>
      <td>678.00</td>
      <td>2559110</td>
      <td>18660.28</td>
      <td>22.60</td>
      <td>33.00</td>
      <td>4.00</td>
      <td>0.00</td>
      <td>437171.00</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>5 rows &#215; 46 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><h3>5.2.4 Save files<a rel="noopener" class="anchor-link" href="#5.2.4-Save-files">&#182;</a></h3>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[64]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#loan_baseline_dummy.to_csv(&#39;baseline_data.csv&#39;)</span>
<span class="c1">#loan_advanced01_mice.to_csv(&#39;advanced01_data.csv&#39;)</span>
<span class="c1">#loan_advanced02_dummy.to_csv(&#39;advanced02_data.csv&#39;)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[65]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">loan_advanced01_mice</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;target&#39;</span><span class="p">:</span><span class="s1">&#39;Loan Status&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>5.3 Modeling<a rel="noopener" class="anchor-link" href="#5.3-Modeling">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><h3>5.3.1 Helper function<a rel="noopener" class="anchor-link" href="#5.3.1-Helper-function">&#182;</a></h3><ul>
<li>train-test splitting, 70%-30%, stratified splitting, randomState=23333.</li>
<li>optional feature importance - use xgboost for feature selection: selecting most importance features.</li>
<li>remove highly correlated variables.</li>
<li>standardization X_train, X_test for models like logistic regression and RBF-Kernel SVM.</li>
</ul>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[91]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">train_test</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">randomState</span><span class="p">):</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;Loan Status&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Loan Status&#39;</span><span class="p">]</span>
    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">randomState</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span>
<span class="c1"># -----------------------------------------------------------------------------------------------------------------------</span>
<span class="k">def</span> <span class="nf">correlation</span><span class="p">(</span><span class="n">train</span><span class="p">):</span>
    <span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>
    <span class="n">upper_matrix</span> <span class="o">=</span> <span class="n">corr_matrix</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">corr_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">))</span>
    <span class="n">to_drop</span> <span class="o">=</span> <span class="p">[</span><span class="n">column</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">upper_matrix</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">upper_matrix</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.7</span><span class="p">)]</span>
    <span class="c1">#print (to_drop)</span>
    <span class="k">return</span> <span class="n">to_drop</span>
<span class="c1"># -----------------------------------------------------------------------------------------------------------------------</span>
<span class="k">def</span> <span class="nf">variable_correlation_dropping</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">x_test</span><span class="p">,</span> <span class="n">drop</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">drop</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x_train</span><span class="p">,</span> <span class="n">x_test</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x_train</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">drop</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">x_test</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">drop</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x_train</span><span class="p">,</span> <span class="n">x_test</span>
<span class="c1"># -----------------------------------------------------------------------------------------------------------------------</span>
<span class="k">def</span> <span class="nf">standardization</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">x_test</span><span class="p">):</span>
    <span class="n">sd</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">StandardScaler</span><span class="p">()</span>
    <span class="n">x_train_sd</span> <span class="o">=</span> <span class="n">sd</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">x_train</span><span class="p">)</span>
    <span class="n">x_test_sd</span> <span class="o">=</span> <span class="n">sd</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x_train_sd</span><span class="p">,</span> <span class="n">x_test_sd</span>
<span class="c1"># -----------------------------------------------------------------------------------------------------------------------</span>
<span class="k">def</span> <span class="nf">step_preprocessing</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">step_feature_selection</span><span class="p">,</span> <span class="n">randomState</span><span class="p">):</span>

    <span class="c1"># train-test splitting</span>
    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">randomState</span><span class="p">)</span>
 
    <span class="c1"># correlation analysis and highly-correlated variable(s) removal</span>
    <span class="n">to_drop</span> <span class="o">=</span> <span class="n">correlation</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span> <span class="o">=</span> <span class="n">variable_correlation_dropping</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">to_drop</span><span class="p">)</span>
        
    <span class="c1"># standardization</span>
    <span class="n">X_train_sd</span><span class="p">,</span> <span class="n">X_test_sd</span> <span class="o">=</span> <span class="n">standardization</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">)</span>
    
    <span class="c1"># get the column, and convert dataframe to numpy_array</span>
    <span class="n">column</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">X_train</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">X_test</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">y_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span>
    <span class="n">y_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">column</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">X_train_sd</span><span class="p">,</span> <span class="n">X_test_sd</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[67]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">evaluation_metrics</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">clf</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;This functions takes the classifier as input and print the evaluation metrics.&#39;&#39;&#39;</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Classifier:&#39;</span><span class="p">,</span> <span class="n">clf</span><span class="p">)</span>
    
    <span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span> <span class="c1"># calculate the predicted value of x_val by classififier</span>
    
    <span class="c1"># train accuracy and test accuracy</span>
    <span class="n">accuracy_train</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">))</span>
    <span class="n">accuracy_test</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
        
    <span class="n">auroc_score</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_pred</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Training accuracy:&#39;</span><span class="p">,</span> <span class="n">accuracy_train</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Test accuracy:&#39;</span><span class="p">,</span> <span class="n">accuracy_test</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;AUROC score:&#39;</span><span class="p">,</span> <span class="n">auroc_score</span><span class="p">)</span>
    
    <span class="c1"># confusion matrix</span>
    <span class="n">confusion</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Confusion matrix:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">confusion</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">accuracy_train</span><span class="p">,</span> <span class="n">accuracy_test</span><span class="p">,</span> <span class="n">auroc_score</span>
<span class="c1"># -----------------------------------------------------------------------------------------------------------------------</span>
<span class="k">def</span> <span class="nf">modeling</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">X_train_sd</span><span class="p">,</span> <span class="n">X_test_sd</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">):</span>
    
    <span class="c1"># initialize all models</span>
    <span class="n">logistic</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">()</span>
    <span class="n">decision_tree</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">23</span><span class="p">)</span>
    <span class="n">random_forest</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">23</span><span class="p">)</span>
    <span class="n">xgboost</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">23</span><span class="p">)</span>

    <span class="c1"># activate all models and get training accuracy, test accuracy, and auroc score</span>
    <span class="n">accuracy_train_log</span><span class="p">,</span> <span class="n">accuracy_test_log</span><span class="p">,</span> <span class="n">auroc_log</span> <span class="o">=</span> <span class="n">evaluation_metrics</span><span class="p">(</span><span class="n">X_train_sd</span><span class="p">,</span> <span class="n">X_test_sd</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">logistic</span><span class="p">)</span>
    <span class="n">accuracy_train_dt</span><span class="p">,</span> <span class="n">accuracy_test_dt</span><span class="p">,</span> <span class="n">auroc_dt</span> <span class="o">=</span> <span class="n">evaluation_metrics</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">decision_tree</span><span class="p">)</span>
    <span class="n">accuracy_train_rf</span><span class="p">,</span> <span class="n">accuracy_test_rf</span><span class="p">,</span> <span class="n">auroc_rf</span> <span class="o">=</span> <span class="n">evaluation_metrics</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">random_forest</span><span class="p">)</span>
    <span class="n">accuracy_train_xgb</span><span class="p">,</span> <span class="n">accuracy_test_xgb</span><span class="p">,</span> <span class="n">auroc_xgb</span> <span class="o">=</span> <span class="n">evaluation_metrics</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">xgboost</span><span class="p">)</span>
    
    <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;Logistic Regression&#39;</span><span class="p">:[</span><span class="n">accuracy_train_log</span><span class="p">,</span> <span class="n">accuracy_test_log</span><span class="p">,</span> <span class="n">auroc_log</span><span class="p">],</span>
        <span class="s1">&#39;Decision Tree&#39;</span><span class="p">:[</span><span class="n">accuracy_train_dt</span><span class="p">,</span> <span class="n">accuracy_test_dt</span><span class="p">,</span> <span class="n">auroc_dt</span><span class="p">],</span>
        <span class="s1">&#39;Random Forest&#39;</span><span class="p">:[</span><span class="n">accuracy_train_rf</span><span class="p">,</span> <span class="n">accuracy_test_rf</span><span class="p">,</span> <span class="n">auroc_rf</span><span class="p">],</span>
        <span class="s1">&#39;Xgboost&#39;</span><span class="p">:[</span><span class="n">accuracy_train_xgb</span><span class="p">,</span> <span class="n">accuracy_test_xgb</span><span class="p">,</span> <span class="n">auroc_xgb</span><span class="p">]},</span>
        <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Training Accuracy&#39;</span><span class="p">,</span> <span class="s1">&#39;Test Accuracy&#39;</span><span class="p">,</span> <span class="s1">&#39;AUROC&#39;</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">result</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[92]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">one_step_function</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">step_feature_selection</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">randomState</span><span class="o">=</span><span class="mi">23333</span><span class="p">):</span>
    <span class="c1"># baseline model</span>
    <span class="n">column_name</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">X_train_sd</span><span class="p">,</span> <span class="n">X_test_sd</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">step_preprocessing</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">step_feature_selection</span><span class="p">,</span> <span class="n">randomState</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">modeling</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">X_train_sd</span><span class="p">,</span> <span class="n">X_test_sd</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">result</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[69]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">train_test</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">randomState</span><span class="p">):</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;Loan Status&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Loan Status&#39;</span><span class="p">]</span>
    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">randomState</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span>
<span class="c1"># -----------------------------------------------------------------------------------------------------------------------</span>
<span class="k">def</span> <span class="nf">normalization</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">):</span>
    <span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>
    <span class="n">X_train_normalized</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
    <span class="n">X_test_normalized</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">X_train_normalized</span><span class="p">,</span> <span class="n">X_test_normalized</span>
<span class="c1"># -----------------------------------------------------------------------------------------------------------------------</span>
<span class="k">def</span> <span class="nf">pca_train</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">proportion</span><span class="p">):</span>
    <span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span> <span class="o">=</span> <span class="n">proportion</span><span class="p">)</span>
    <span class="n">pca</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="p">)</span>
    
    <span class="n">train_pca</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">train</span><span class="p">)</span>
    <span class="n">test_pca</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">train_pca</span><span class="p">,</span> <span class="n">test_pca</span>
<span class="c1"># -----------------------------------------------------------------------------------------------------------------------</span>
<span class="k">def</span> <span class="nf">step_pca</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">proportion</span><span class="p">,</span> <span class="n">randomState</span><span class="p">):</span>
    <span class="c1"># train-test split</span>
    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">randomState</span><span class="p">)</span>
    
    <span class="c1"># normalization</span>
    <span class="n">X_train_normalized</span><span class="p">,</span> <span class="n">X_test_normalized</span> <span class="o">=</span> <span class="n">normalization</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">)</span>
    
    <span class="c1"># pca</span>
    <span class="n">X_train_pca</span><span class="p">,</span> <span class="n">X_test_pca</span> <span class="o">=</span> <span class="n">pca_train</span><span class="p">(</span><span class="n">X_train_normalized</span><span class="p">,</span> <span class="n">X_test_normalized</span><span class="p">,</span> <span class="n">proportion</span><span class="p">)</span>
    
    <span class="n">y_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span>
    <span class="n">y_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">X_train_pca</span><span class="p">,</span> <span class="n">X_test_pca</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span>
<span class="c1"># -----------------------------------------------------------------------------------------------------------------------</span>
<span class="k">def</span> <span class="nf">modeling_pca</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">):</span>
    
    <span class="c1"># initialize all models</span>
    <span class="n">logistic</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">()</span>
    <span class="n">decision_tree</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">23</span><span class="p">)</span>
    <span class="n">random_forest</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">23</span><span class="p">)</span>
    <span class="n">xgboost</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">23</span><span class="p">)</span>
    
    <span class="c1"># activate all models and get training accuracy, test accuracy, and auroc score</span>
    <span class="n">accuracy_train_log</span><span class="p">,</span> <span class="n">accuracy_test_log</span><span class="p">,</span> <span class="n">auroc_log</span> <span class="o">=</span> <span class="n">evaluation_metrics</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">logistic</span><span class="p">)</span>
    <span class="n">accuracy_train_dt</span><span class="p">,</span> <span class="n">accuracy_test_dt</span><span class="p">,</span> <span class="n">auroc_dt</span> <span class="o">=</span> <span class="n">evaluation_metrics</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">decision_tree</span><span class="p">)</span>
    <span class="n">accuracy_train_rf</span><span class="p">,</span> <span class="n">accuracy_test_rf</span><span class="p">,</span><span class="n">auroc_rf</span> <span class="o">=</span> <span class="n">evaluation_metrics</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">random_forest</span><span class="p">)</span>
    <span class="n">accuracy_train_xgb</span><span class="p">,</span> <span class="n">accuracy_test_xgb</span><span class="p">,</span><span class="n">auroc_xgb</span> <span class="o">=</span> <span class="n">evaluation_metrics</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">xgboost</span><span class="p">)</span>
    
    <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;Logistic Regression&#39;</span><span class="p">:[</span><span class="n">accuracy_train_log</span><span class="p">,</span> <span class="n">accuracy_test_log</span><span class="p">,</span> <span class="n">auroc_log</span><span class="p">],</span>
        <span class="s1">&#39;Decision Tree&#39;</span><span class="p">:[</span><span class="n">accuracy_train_dt</span><span class="p">,</span> <span class="n">accuracy_test_dt</span><span class="p">,</span> <span class="n">auroc_dt</span><span class="p">],</span>
        <span class="s1">&#39;Random Forest&#39;</span><span class="p">:[</span><span class="n">accuracy_train_rf</span><span class="p">,</span> <span class="n">accuracy_test_rf</span><span class="p">,</span> <span class="n">auroc_rf</span><span class="p">],</span>
        <span class="s1">&#39;Xgboost&#39;</span><span class="p">:[</span><span class="n">accuracy_train_xgb</span><span class="p">,</span> <span class="n">accuracy_test_xgb</span><span class="p">,</span> <span class="n">auroc_xgb</span><span class="p">]},</span>
        <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Training Accuracy&#39;</span><span class="p">,</span> <span class="s1">&#39;Test Accuracy&#39;</span><span class="p">,</span> <span class="s1">&#39;AUROC&#39;</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">result</span>
<span class="c1"># -----------------------------------------------------------------------------------------------------------------------</span>
<span class="k">def</span> <span class="nf">one_step_pca_model</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">proportion</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">randomState</span><span class="o">=</span><span class="mi">23333</span><span class="p">):</span>
    <span class="n">X_train_pca</span><span class="p">,</span> <span class="n">X_test_pca</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">step_pca</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">proportion</span><span class="p">,</span> <span class="n">randomState</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">modeling_pca</span><span class="p">(</span><span class="n">X_train_pca</span><span class="p">,</span> <span class="n">X_test_pca</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><h3>5.3.2 baseline model<a rel="noopener" class="anchor-link" href="#5.3.2-baseline-model">&#182;</a></h3>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[70]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">baseline_result01</span> <span class="o">=</span> <span class="n">one_step_function</span><span class="p">(</span><span class="n">loan_baseline_dummy</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Classifier: LogisticRegression()
Training accuracy: 0.8488782554126137
Test accuracy: 0.8492724444037705
AUROC score: 0.6320421926202293
Confusion matrix:
 [[8689    3]
 [1644  591]]
------------------------------------------------------------
Classifier: DecisionTreeClassifier(random_state=23)
Training accuracy: 1.0
Test accuracy: 0.7876818888990573
AUROC score: 0.6652884804459035
Confusion matrix:
 [[7583 1109]
 [1211 1024]]
------------------------------------------------------------
Classifier: RandomForestClassifier(random_state=23)
Training accuracy: 1.0
Test accuracy: 0.8500960922485586
AUROC score: 0.6350527523573324
Confusion matrix:
 [[8683    9]
 [1629  606]]
------------------------------------------------------------
Classifier: XGBClassifier(random_state=23)
Training accuracy: 0.8489174772513336
Test accuracy: 0.8496385101125652
AUROC score: 0.6324384787472036
Confusion matrix:
 [[8692    0]
 [1643  592]]
------------------------------------------------------------
Wall time: 7.47 s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[71]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">baseline_result02</span> <span class="o">=</span> <span class="n">one_step_pca_model</span><span class="p">(</span><span class="n">loan_baseline_dummy</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Classifier: LogisticRegression()
Training accuracy: 0.8489174772513336
Test accuracy: 0.8495469936853666
AUROC score: 0.6322147651006711
Confusion matrix:
 [[8692    0]
 [1644  591]]
------------------------------------------------------------
Classifier: DecisionTreeClassifier(random_state=23)
Training accuracy: 1.0
Test accuracy: 0.7861261096366798
AUROC score: 0.6548377689994451
Confusion matrix:
 [[7623 1069]
 [1268  967]]
------------------------------------------------------------
Classifier: RandomForestClassifier(random_state=23)
Training accuracy: 0.9999215563225604
Test accuracy: 0.8444220737622403
AUROC score: 0.6452799817981718
Confusion matrix:
 [[8538  154]
 [1546  689]]
------------------------------------------------------------
Classifier: XGBClassifier(random_state=23)
Training accuracy: 0.8489174772513336
Test accuracy: 0.8495469936853666
AUROC score: 0.6322147651006711
Confusion matrix:
 [[8692    0]
 [1644  591]]
------------------------------------------------------------
Wall time: 15.3 s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[72]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">advanced01_result01</span> <span class="o">=</span> <span class="n">one_step_function</span><span class="p">(</span><span class="n">loan_advanced01_mice</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Classifier: LogisticRegression()
Training accuracy: 0.7739
Test accuracy: 0.7738333333333334
AUROC score: 0.5015046748836456
Confusion matrix:
 [[23189    19]
 [ 6766    26]]
------------------------------------------------------------
Classifier: DecisionTreeClassifier(random_state=23)
Training accuracy: 1.0
Test accuracy: 0.7145
AUROC score: 0.5832852964068683
Confusion matrix:
 [[19102  4106]
 [ 4459  2333]]
------------------------------------------------------------
Classifier: RandomForestClassifier(random_state=23)
Training accuracy: 0.9999714285714286
Test accuracy: 0.7805333333333333
AUROC score: 0.5250495442658374
Confusion matrix:
 [[23021   187]
 [ 6397   395]]
------------------------------------------------------------
Classifier: XGBClassifier(random_state=23)
Training accuracy: 0.7741571428571429
Test accuracy: 0.7738666666666667
AUROC score: 0.5008492867696408
Confusion matrix:
 [[23203     5]
 [ 6779    13]]
------------------------------------------------------------
Wall time: 24.2 s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[73]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">advanced01_result02</span> <span class="o">=</span> <span class="n">one_step_pca_model</span><span class="p">(</span><span class="n">loan_advanced01_mice</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Classifier: LogisticRegression()
Training accuracy: 0.7736142857142857
Test accuracy: 0.7736
AUROC score: 0.5
Confusion matrix:
 [[23208     0]
 [ 6792     0]]
------------------------------------------------------------
Classifier: DecisionTreeClassifier(random_state=23)
Training accuracy: 1.0
Test accuracy: 0.6942
AUROC score: 0.5590735435447507
Confusion matrix:
 [[18706  4502]
 [ 4672  2120]]
------------------------------------------------------------
Classifier: RandomForestClassifier(random_state=23)
Training accuracy: 0.9999571428571429
Test accuracy: 0.7635
AUROC score: 0.5411697775715211
Confusion matrix:
 [[21989  1219]
 [ 5876   916]]
------------------------------------------------------------
Classifier: XGBClassifier(random_state=23)
Training accuracy: 0.7737285714285714
Test accuracy: 0.7736333333333333
AUROC score: 0.5001256877426208
Confusion matrix:
 [[23207     1]
 [ 6790     2]]
------------------------------------------------------------
Wall time: 44.6 s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[74]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">advanced02_result01</span> <span class="o">=</span> <span class="n">one_step_function</span><span class="p">(</span><span class="n">loan_advanced02_dummy</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Classifier: LogisticRegression()
Training accuracy: 0.8197071319200327
Test accuracy: 0.8210637548432547
AUROC score: 0.6345962022567161
Confusion matrix:
 [[15007     2]
 [ 3554  1310]]
------------------------------------------------------------
Classifier: DecisionTreeClassifier(random_state=23)
Training accuracy: 1.0
Test accuracy: 0.7528807930357772
AUROC score: 0.6572022589626049
Confusion matrix:
 [[12677  2332]
 [ 2579  2285]]
------------------------------------------------------------
Classifier: RandomForestClassifier(random_state=23)
Training accuracy: 1.0
Test accuracy: 0.8213153524883007
AUROC score: 0.6365693193732883
Confusion matrix:
 [[14986    23]
 [ 3528  1336]]
------------------------------------------------------------
Classifier: XGBClassifier(random_state=23)
Training accuracy: 0.8197071319200327
Test accuracy: 0.8210637548432547
AUROC score: 0.6345267195494108
Confusion matrix:
 [[15008     1]
 [ 3555  1309]]
------------------------------------------------------------
Wall time: 15.1 s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[75]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">advanced02_result02</span> <span class="o">=</span> <span class="n">one_step_pca_model</span><span class="p">(</span><span class="n">loan_advanced02_dummy</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Classifier: LogisticRegression()
Training accuracy: 0.8196424335223964
Test accuracy: 0.8210134353142454
AUROC score: 0.6343544407894737
Confusion matrix:
 [[15009     0]
 [ 3557  1307]]
------------------------------------------------------------
Classifier: DecisionTreeClassifier(random_state=23)
Training accuracy: 1.0
Test accuracy: 0.7441251949881749
AUROC score: 0.648279015047112
Confusion matrix:
 [[12548  2461]
 [ 2624  2240]]
------------------------------------------------------------
Classifier: RandomForestClassifier(random_state=23)
Training accuracy: 0.9999784338674546
Test accuracy: 0.8073768429527499
AUROC score: 0.6417244431301745
Confusion matrix:
 [[14502   507]
 [ 3321  1543]]
------------------------------------------------------------
Classifier: XGBClassifier(random_state=23)
Training accuracy: 0.8196639996549419
Test accuracy: 0.8210134353142454
AUROC score: 0.6343544407894737
Confusion matrix:
 [[15009     0]
 [ 3557  1307]]
------------------------------------------------------------
Wall time: 34.3 s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[76]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Baseline Model w/o PCA:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">baseline_result01</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="o">*</span><span class="mi">90</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Baseline Model w PCA:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">baseline_result02</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="o">*</span><span class="mi">90</span><span class="p">)</span>

<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Advanced Model 01 w/o PCA:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">advanced01_result01</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="o">*</span><span class="mi">90</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Advanced Model 01 w PCA:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">advanced01_result02</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="o">*</span><span class="mi">90</span><span class="p">)</span>

<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Advanced Model 02 w/o PCA:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">advanced02_result01</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="o">*</span><span class="mi">90</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Advanced Model 02 w PCA:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">advanced02_result02</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="o">*</span><span class="mi">90</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>	Baseline Model w/o PCA:
                    Logistic Regression  Decision Tree  Random Forest  Xgboost
Training Accuracy                 0.85           1.00           1.00     0.85
Test Accuracy                     0.85           0.79           0.85     0.85
AUROC                             0.63           0.67           0.64     0.63
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
	Baseline Model w PCA:
                    Logistic Regression  Decision Tree  Random Forest  Xgboost
Training Accuracy                 0.85           1.00           1.00     0.85
Test Accuracy                     0.85           0.79           0.84     0.85
AUROC                             0.63           0.65           0.65     0.63
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
	Advanced Model 01 w/o PCA:
                    Logistic Regression  Decision Tree  Random Forest  Xgboost
Training Accuracy                 0.77           1.00           1.00     0.77
Test Accuracy                     0.77           0.71           0.78     0.77
AUROC                             0.50           0.58           0.53     0.50
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
	Advanced Model 01 w PCA:
                    Logistic Regression  Decision Tree  Random Forest  Xgboost
Training Accuracy                 0.77           1.00           1.00     0.77
Test Accuracy                     0.77           0.69           0.76     0.77
AUROC                             0.50           0.56           0.54     0.50
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
	Advanced Model 02 w/o PCA:
                    Logistic Regression  Decision Tree  Random Forest  Xgboost
Training Accuracy                 0.82           1.00           1.00     0.82
Test Accuracy                     0.82           0.75           0.82     0.82
AUROC                             0.63           0.66           0.64     0.63
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
	Advanced Model 02 w PCA:
                    Logistic Regression  Decision Tree  Random Forest  Xgboost
Training Accuracy                 0.82           1.00           1.00     0.82
Test Accuracy                     0.82           0.74           0.81     0.82
AUROC                             0.63           0.65           0.64     0.63
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>By comparing the training accuracy, test accuracy and AUROC score of the above models, we found:<ul>
<li>For baseline model, the decision tree has the highest AUROC score, but the model tends to be more overfitting than the other three models. Using PCA increase the performance of logistic regression by a little.</li>
<li>For advanced model 01, which uses MICE imputation for missing value, decision tree has higher AUROC score. But compared with baseline model, the AUROC decreases.</li>
<li>For advanced model 02, which uses the fixed value for missing value, devision tree has the best AUROC score. Besides, logistic regression and xgboost tends to be less overfitting than decision tree or random forest.</li>
<li>One other thing, the removed column <strong>|Months since last delinquent|</strong> in advanced model 01 does provide information in model building process. So that, we should not directly delete this column.</li>
</ul>
</li>
</ul>
<ul>
<li>Therefore, we choose baseline model without PCA, and perform hyperparameters grid search on logistic regression and decision tree models.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><h3>5.3.3 Grid search<a rel="noopener" class="anchor-link" href="#5.3.3-Grid-search">&#182;</a></h3>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[77]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">Grid_Search</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">classifier</span><span class="p">,</span> <span class="n">parameter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cross_validation</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;This function takes the classifier and parameter as input, does cross validation and prints the result.&#39;&#39;&#39;</span>
    <span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">classifier</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">parameter</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cross_validation</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;roc_auc&#39;</span><span class="p">)</span>
    <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="c1"># print (&#39;Best parameter: \n&#39;, grid_search.best_params_)</span>
    <span class="k">return</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[93]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">column_name</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">X_train_sd</span><span class="p">,</span> <span class="n">X_test_sd</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">step_preprocessing</span><span class="p">(</span><span class="n">loan_baseline_dummy</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> 
                                                                                          <span class="n">randomState</span><span class="o">=</span><span class="mi">23333</span><span class="p">)</span>

<span class="nb">print</span> <span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">column_name</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>(25496, 43)
[&#39;Current Loan Amount&#39;, &#39;Credit Score&#39;, &#39;Annual Income&#39;, &#39;Monthly Debt&#39;, &#39;Years of Credit History&#39;, &#39;Months since last delinquent&#39;, &#39;Number of Open Accounts&#39;, &#39;Number of Credit Problems&#39;, &#39;Current Credit Balance&#39;, &#39;Maximum Open Credit&#39;, &#39;Bankruptcies&#39;, &#39;Tax Liens&#39;, &#39;Term_Long Term&#39;, &#39;Years in current job_1 year&#39;, &#39;Years in current job_10+ years&#39;, &#39;Years in current job_2 years&#39;, &#39;Years in current job_3 years&#39;, &#39;Years in current job_4 years&#39;, &#39;Years in current job_5 years&#39;, &#39;Years in current job_6 years&#39;, &#39;Years in current job_7 years&#39;, &#39;Years in current job_8 years&#39;, &#39;Years in current job_9 years&#39;, &#39;Years in current job_&lt; 1 year&#39;, &#39;Home Ownership_HaveMortgage&#39;, &#39;Home Ownership_Home Mortgage&#39;, &#39;Home Ownership_Own Home&#39;, &#39;Purpose_Business Loan&#39;, &#39;Purpose_Buy House&#39;, &#39;Purpose_Buy a Car&#39;, &#39;Purpose_Debt Consolidation&#39;, &#39;Purpose_Educational Expenses&#39;, &#39;Purpose_Home Improvements&#39;, &#39;Purpose_Medical Bills&#39;, &#39;Purpose_Other&#39;, &#39;Purpose_Take a Trip&#39;, &#39;Purpose_major_purchase&#39;, &#39;Purpose_moving&#39;, &#39;Purpose_other&#39;, &#39;Purpose_renewable_energy&#39;, &#39;Purpose_small_business&#39;, &#39;Purpose_vacation&#39;, &#39;Purpose_wedding&#39;]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><p>Logistic Regression</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[79]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">log</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;solver&#39;</span><span class="p">:[</span><span class="s1">&#39;lbfgs&#39;</span><span class="p">,</span> <span class="s1">&#39;liblinear&#39;</span><span class="p">],</span>
       <span class="s1">&#39;penalty&#39;</span><span class="p">:[</span><span class="s1">&#39;l1&#39;</span><span class="p">,</span> <span class="s1">&#39;l2&#39;</span><span class="p">,</span> <span class="s1">&#39;elasticnet&#39;</span><span class="p">],</span>
       <span class="s1">&#39;C&#39;</span><span class="p">:[</span><span class="mf">0.0001</span><span class="p">,</span> <span class="mf">0.0005</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">]}</span>

<span class="n">logistic</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">()</span>

<span class="n">logistic_fitted</span> <span class="o">=</span> <span class="n">Grid_Search</span><span class="p">(</span><span class="n">X_train_sd</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">logistic</span><span class="p">,</span> <span class="n">log</span><span class="p">)</span>

<span class="n">accuracy_train_log</span><span class="p">,</span> <span class="n">accuracy_test_log</span><span class="p">,</span> <span class="n">auroc_log</span> <span class="o">=</span> <span class="n">evaluation_metrics</span><span class="p">(</span><span class="n">X_train_sd</span><span class="p">,</span> <span class="n">X_test_sd</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">logistic_fitted</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Classifier: LogisticRegression(C=0.05, penalty=&#39;l1&#39;, solver=&#39;liblinear&#39;)
Training accuracy: 0.8488782554126137
Test accuracy: 0.8494554772581678
AUROC score: 0.6321572409405238
Confusion matrix:
 [[8691    1]
 [1644  591]]
------------------------------------------------------------
Wall time: 1min 28s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Previous result: training accuracy: 0.848878; test accuracy: 0.849282; AUROC: 0.632042.</li>
<li>based on the original results shown above, we know that the result does improve a little. Maybe we should perform the analysis on a more precise dataset, or performing feature selection.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[96]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;feature&#39;</span><span class="p">:</span> <span class="n">column_name</span><span class="p">,</span> 
    <span class="s1">&#39;importance&#39;</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">logistic_fitted</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">0</span><span class="p">])})</span>
<span class="n">df1</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;importance&#39;</span><span class="p">)</span>

<span class="c1"># plotting</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;feature&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;importance&#39;</span><span class="p">,</span> 
              <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Feature Importance&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Based on the feature importance graph above, we know that the most importance features are Credit Score, Current Loan Amount, Annual Income, Term(Long term), Monthly debt, Home Ownership(Home Mortgate), etc. (the remaining are not so significant features compared with the abovementioned features)</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><p>Decision Tree</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[80]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd"># this shows the iterative process of hyperparamter grid search</span>
<span class="sd">dt = {&#39;max_depth&#39;:[3, 5, 7, 9],</span>
<span class="sd">      &#39;criterion&#39;:[&#39;gini&#39;, &#39;entropy&#39;],</span>
<span class="sd">      &#39;min_samples_leaf&#39;:[20,40,60,80,100]}</span>
<span class="sd">Training accuracy: 0.8493096956385315</span>
<span class="sd">Test accuracy: 0.8491809279765717</span>
<span class="sd">AUROC score: 0.6358070266469411</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">dt</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;max_depth&#39;</span><span class="p">:[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span>
      <span class="s1">&#39;criterion&#39;</span><span class="p">:[</span><span class="s1">&#39;gini&#39;</span><span class="p">,</span> <span class="s1">&#39;entropy&#39;</span><span class="p">],</span>
      <span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">:[</span><span class="mi">50</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span> <span class="mi">100</span><span class="p">]}</span>


<span class="n">decision_tree</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">23</span><span class="p">)</span>

<span class="n">decision_tree_fitted</span> <span class="o">=</span> <span class="n">Grid_Search</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">decision_tree</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>

<span class="n">accuracy_train_dt</span><span class="p">,</span> <span class="n">accuracy_test_dt</span><span class="p">,</span> <span class="n">auroc_dt</span> <span class="o">=</span> <span class="n">evaluation_metrics</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">decision_tree_fitted</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Classifier: DecisionTreeClassifier(criterion=&#39;entropy&#39;, max_depth=10, min_samples_leaf=80,
                       random_state=23)
Training accuracy: 0.8493096956385315
Test accuracy: 0.8491809279765717
AUROC score: 0.6358070266469411
Confusion matrix:
 [[8665   27]
 [1621  614]]
------------------------------------------------------------
Wall time: 49.5 s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Previous result: training accuracy: 1; test accuracy: 0.787682; AUROC: 0.665288.</li>
<li>The hyperparameter grid search really reduces the overfitting of the model by reducing the training accuracy and increasing the test accuracy, but the AUROC score also decreases around 0.03.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[97]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;feature&#39;</span><span class="p">:</span> <span class="n">column_name</span><span class="p">,</span> 
    <span class="s1">&#39;importance&#39;</span><span class="p">:</span> <span class="n">decision_tree_fitted</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">})</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;importance&#39;</span><span class="p">)</span>

<span class="c1"># plotting</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;feature&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;importance&#39;</span><span class="p">,</span> 
              <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Feature Importance&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Based on the feature importance graph above, we know that the most importance features are Credit Score, Current Loan Amount, Annual Income,and monthly debt. (the remaining are not so significant features compared with the abovementioned features)</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1>6. Result and Conclusion<a rel="noopener" class="anchor-link" href="#6.-Result-and-Conclusion">&#182;</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>6.1 Research question related<a rel="noopener" class="anchor-link" href="#6.1-Research-question-related">&#182;</a></h2><ul>
<li><p>By doing the EDA and modeling, we answered the research successfully. During the process, we deal with the missing value and information leakage, and try to find the best way to fill in these missings and get the well predicted model.</p>
</li>
<li><p>After all theimputation methods and modeling, the logistic regression &amp; decision tree provide a better model performance compared with others. The model accuracies for thses two are around 80%, and the AUROC around 65%, which is a little bit lower than our expectations, but that&#39;s the best result we can get for current stage. If we have enough time, we probably going to try multiple ways to test the data, and hyper-parameter tuning, and try to increase our model accuracy and auroc score, lower the error at the same time. And connect with our real-life, I believe our model could provide a great help to loan analysts.</p>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>6.2 Discussion<a rel="noopener" class="anchor-link" href="#6.2-Discussion">&#182;</a></h2><ul>
<li>Based on the above result, we believe the logistic regression or decision tree provide better model performance, no matter in AUROC score or solving model overfitting. </li>
<li>If we have more time, we will:<ul>
<li>1) come up with a &quot;new&quot; dataset, with missing value fixed or imputation. We believe the good quality of data really has a great impact on the model performance.</li>
<li>2) perform a much detailed hyperparameter grid search on more models with the help of much advanced computational power, as well as performing KPCA. These are the key step to avoid model overfitting.</li>
</ul>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1>7. Reference<a rel="noopener" class="anchor-link" href="#7.-Reference">&#182;</a></h1><ol>
<li><a rel="noopener" href="https://jamesrledoux.com/code/imputation#:~:text=One%20approach%20to%20imputing%20categorical,given%20in%20Pandas&#39;%20value_counts%20function">https://jamesrledoux.com/code/imputation#:~:text=One%20approach%20to%20imputing%20categorical,given%20in%20Pandas&#39;%20value_counts%20function</a>.</li>
<li><a rel="noopener" href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3074241/#:~:text=Missing%20data%20are%20a%20common,method%20of%20addressing%20missing%20data">https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3074241/#:~:text=Missing%20data%20are%20a%20common,method%20of%20addressing%20missing%20data</a>. </li>
<li><a rel="noopener" href="https://stats.stackexchange.com/questions/421545/multiple-imputation-by-chained-equations-mice-explained">https://stats.stackexchange.com/questions/421545/multiple-imputation-by-chained-equations-mice-explained</a></li>
<li><a rel="noopener" href="https://stackoverflow.com/questions/29611842/scikit-learn-kernel-pca-explained-variance/40687862">https://stackoverflow.com/questions/29611842/scikit-learn-kernel-pca-explained-variance/40687862</a></li>
<li><a rel="noopener" href="https://stats.stackexchange.com/questions/348574/memoryerror-for-scikitlearn-kernel-pca">https://stats.stackexchange.com/questions/348574/memoryerror-for-scikitlearn-kernel-pca</a></li>
<li><a rel="noopener" href="https://mlwhiz.com/blog/2019/08/07/feature_selection/">https://mlwhiz.com/blog/2019/08/07/feature_selection/</a></li>
<li><a rel="noopener" href="https://towardsai.net/p/data-science/how-when-and-why-should-you-normalize-standardize-rescale-your-data-3f083def38ff">https://towardsai.net/p/data-science/how-when-and-why-should-you-normalize-standardize-rescale-your-data-3f083def38ff</a></li>
<li><a rel="noopener" href="https://machinelearningmastery.com/stacking-ensemble-machine-learning-with-python/">https://machinelearningmastery.com/stacking-ensemble-machine-learning-with-python/</a></li>
<li><a rel="noopener" href="https://stackoverflow.com/questions/63847646/svm-takes-long-time-for-hyperparameter-tuning">https://stackoverflow.com/questions/63847646/svm-takes-long-time-for-hyperparameter-tuning</a></li>
<li><a rel="noopener" href="https://www.analyticsvidhya.com/blog/2020/03/beginners-guide-random-forest-hyperparameter-tuning/">https://www.analyticsvidhya.com/blog/2020/03/beginners-guide-random-forest-hyperparameter-tuning/</a></li>
<li><a rel="noopener" href="https://machinelearningmastery.com/introduction-to-bayesian-belief-networks/">https://machinelearningmastery.com/introduction-to-bayesian-belief-networks/</a></li>
<li><a rel="noopener" href="https://machinelearningmastery.com/calculate-feature-importance-with-python/">https://machinelearningmastery.com/calculate-feature-importance-with-python/</a></li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[&#160;]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    </div>
  </div>


 



<script type="text/javascript" src="/d2l/common/math/MathML.js?v=20.22.1.34798 "></script><script type="text/javascript">document.addEventListener('DOMContentLoaded', function() { D2LMathML.DesktopInit('https://s.brightspace.com/lib/mathjax/2.7.4/MathJax.js?config=MML_HTMLorMML','https://s.brightspace.com/lib/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML','130',false); });</script></body></html>